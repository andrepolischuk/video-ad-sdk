{"version":3,"file":"demo.js","mappings":"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","sources":["webpack:///video-ad-sdk/webpack/universalModuleDefinition","webpack:///video-ad-sdk/./node_modules/lodash.debounce/index.js","webpack:///video-ad-sdk/./node_modules/sane-domparser-error/index.js","webpack:///video-ad-sdk/webpack/bootstrap","webpack:///video-ad-sdk/webpack/runtime/compat get default export","webpack:///video-ad-sdk/webpack/runtime/define property getters","webpack:///video-ad-sdk/webpack/runtime/global","webpack:///video-ad-sdk/webpack/runtime/hasOwnProperty shorthand","webpack:///video-ad-sdk/webpack/runtime/make namespace object","webpack:///video-ad-sdk/./src/tracker/errorCode.ts","webpack:///video-ad-sdk/./src/tracker/linearEvents.ts","webpack:///video-ad-sdk/./src/tracker/nonLinearEvents.ts","webpack:///video-ad-sdk/./src/types/xml.ts","webpack:///video-ad-sdk/./src/xml/helpers/xmlToJson.ts","webpack:///video-ad-sdk/./src/xml/helpers/xmlSelectors.ts","webpack:///video-ad-sdk/./src/xml/index.ts","webpack:///video-ad-sdk/./src/vastSelectors/helpers/parseTime.ts","webpack:///video-ad-sdk/./src/vastSelectors/helpers/parseOffset.ts","webpack:///video-ad-sdk/./src/vastSelectors/helpers/getLinearCreative.ts","webpack:///video-ad-sdk/./src/vastSelectors/getLinearTrackingEvents.ts","webpack:///video-ad-sdk/./src/vastSelectors/getIcons.ts","webpack:///video-ad-sdk/./src/vastSelectors/index.ts","webpack:///video-ad-sdk/./src/tracker/helpers/pixelTracker.ts","webpack:///video-ad-sdk/./src/tracker/helpers/parseMacro.ts","webpack:///video-ad-sdk/./src/tracker/helpers/trackError.ts","webpack:///video-ad-sdk/./src/tracker/helpers/createVastEventTracker.ts","webpack:///video-ad-sdk/./src/tracker/trackLinearEvent.ts","webpack:///video-ad-sdk/./src/tracker/helpers/trackIconClick.ts","webpack:///video-ad-sdk/./src/tracker/helpers/trackIconView.ts","webpack:///video-ad-sdk/./src/tracker/helpers/trackProgress.ts","webpack:///video-ad-sdk/./src/tracker/trackNonLinearEvent.ts","webpack:///video-ad-sdk/./src/vastSelectors/getNonLinearTrackingEvents.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/getContentDocument.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/supportsSrcdoc.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/createIframe.ts","webpack:///video-ad-sdk/./src/adContainer/VideoAdContainer.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/unique.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/createAdContainer.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/createAdVideoElement.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/getOrigin.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/loadScript.ts","webpack:///video-ad-sdk/./src/adContainer/helpers/createSlot.ts","webpack:///video-ad-sdk/./src/adContainer/createVideoAdContainer.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/media/guessMimeType.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/media/canPlay.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/media/sortMediaByBestFit.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/media/findBestMedia.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/once.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/progress/getProgressEvents.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/safeCallback.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onFullscreenChange.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onPlayPause.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onRewind.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onSkip.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onError.ts","webpack:///video-ad-sdk/./src/adUnit/adUnitEvents.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onTimeUpdate.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onVolumeChange.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onImpression.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/progress/toFixedDigits.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/progress/formatProgress.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onProgress.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/onClickThrough.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/handlers/index.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/adUnitError.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/elementObservers/helpers/MutationObserver.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/elementObservers/onElementResize.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/elementObservers/helpers/IntersectionObserver.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/elementObservers/onElementVisibilityChange.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/Emitter/index.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/getResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/retrieveIcons.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/waitFor.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/fetch/fetchHtml.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/createResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/loadResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/createStaticResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/createHtmlResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/resources/createIframeResource.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/canBeRendered.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/renderIcon.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/renderIcons.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/canBeShown.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/updateIcon.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/icons/addIcons.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/viewmode.ts","webpack:///video-ad-sdk/./src/adUnit/VideoAdUnit.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/dom/preventManualProgress.ts","webpack:///video-ad-sdk/./src/adUnit/VastAdUnit.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/metrics/setupMetricHandlers.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/media/updateMedia.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/isSupported.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/api.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/waitFor.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/callAndWait.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/handshake.ts","webpack:///video-ad-sdk/./src/adUnit/VpaidAdUnit.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/loadCreative.ts","webpack:///video-ad-sdk/./src/adUnit/helpers/vpaid/initAd.ts","webpack:///video-ad-sdk/./src/adUnit/createVideoAdUnit.ts","webpack:///video-ad-sdk/./src/vastRequest/helpers/vastError.ts","webpack:///video-ad-sdk/./src/runner/helpers/startVideoAd.ts","webpack:///video-ad-sdk/./src/vastRequest/helpers/fetch.ts","webpack:///video-ad-sdk/./src/vastRequest/helpers/adUtils.ts","webpack:///video-ad-sdk/./src/vastRequest/requestAd.ts","webpack:///video-ad-sdk/./src/xml/helpers/xml2js.ts","webpack:///video-ad-sdk/./src/vastRequest/requestNextAd.ts","webpack:///video-ad-sdk/./src/vastRequest/helpers/getNextAd.ts","webpack:///video-ad-sdk/./src/runner/runWaterfall.ts","webpack:///video-ad-sdk/./src/runner/run.ts","webpack:///video-ad-sdk/./demo/index.ts","webpack:///video-ad-sdk/./src/utils/isIos.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, function() {\nreturn ","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = debounce;\n","'use strict';\n\nvar innerXML = function (node) {\n    var s = new XMLSerializer();\n    return Array.prototype.map.call(node.childNodes, function (node) {\n        return s.serializeToString(node);\n    }).join('');\n};\n\nvar getParseError = function (doc) {\n    // Firefox\n    if (doc.documentElement.tagName === 'parsererror' &&\n        doc.documentElement.namespaceURI === 'http://www.mozilla.org/newlayout/xml/parsererror.xml') {\n        return doc.documentElement;\n    }\n\n    // Chrome, Safari\n    if ((doc.documentElement.tagName === 'xml' || doc.documentElement.tagName === 'html') &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0];\n    }\n\n    // PhantomJS\n    if (doc.documentElement.tagName === 'html' &&\n        doc.documentElement.childNodes &&\n        doc.documentElement.childNodes.length > 0 &&\n        doc.documentElement.childNodes[0].nodeName === 'body' &&\n        doc.documentElement.childNodes[0].childNodes &&\n        doc.documentElement.childNodes[0].childNodes.length &&\n        doc.documentElement.childNodes[0].childNodes[0].nodeName === 'parsererror') {\n        return doc.documentElement.childNodes[0].childNodes[0];\n    }\n\n    return undefined;\n};\n\nvar errorMessagePatterns = [\n    // Chrome, Safari, PhantomJS\n    new RegExp('^<h3[^>]*>This page contains the following errors:<\\/h3><div[^>]*>(.+?)\\n?<\\/div>'),\n    // Firefox\n    new RegExp('^(.+)\\n')\n];\n\nvar extractParseError = function (errorNode) {\n    var content = innerXML(errorNode);\n    var i, match;\n\n    for(i = 0; i < errorMessagePatterns.length; i++) {\n        match = errorMessagePatterns[i].exec(content);\n\n        if (match) {\n            return match[1];\n        }\n    }\n    return undefined;\n};\n\nvar failOnParseError = function (doc) {\n    var errorMessage;\n\n    if (doc === null) {\n        throw new Error('Parse error');\n    }\n\n    var parseError = getParseError(doc);\n    if (parseError !== undefined) {\n        errorMessage = extractParseError(parseError) || 'Parse error';\n        throw new Error(errorMessage);\n    }\n};\n\nexports.failOnParseError = function (doc) {\n    failOnParseError(doc);\n\n    return doc;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export var ErrorCode;\n(function (ErrorCode) {\n    ErrorCode[ErrorCode[\"VAST_XML_PARSING_ERROR\"] = 100] = \"VAST_XML_PARSING_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_SCHEMA_VALIDATION_ERROR\"] = 101] = \"VAST_SCHEMA_VALIDATION_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_UNSUPPORTED_VERSION\"] = 102] = \"VAST_UNSUPPORTED_VERSION\";\n    ErrorCode[ErrorCode[\"VAST_UNEXPECTED_AD_TYPE\"] = 200] = \"VAST_UNEXPECTED_AD_TYPE\";\n    ErrorCode[ErrorCode[\"VAST_UNEXPECTED_LINEARITY\"] = 201] = \"VAST_UNEXPECTED_LINEARITY\";\n    ErrorCode[ErrorCode[\"VAST_UNEXPECTED_DURATION_ERROR\"] = 202] = \"VAST_UNEXPECTED_DURATION_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_UNEXPECTED_MEDIA_FILE\"] = 203] = \"VAST_UNEXPECTED_MEDIA_FILE\";\n    ErrorCode[ErrorCode[\"VAST_WRAPPER_ERROR\"] = 300] = \"VAST_WRAPPER_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_LOAD_TIMEOUT\"] = 301] = \"VAST_LOAD_TIMEOUT\";\n    ErrorCode[ErrorCode[\"VAST_TOO_MANY_REDIRECTS\"] = 302] = \"VAST_TOO_MANY_REDIRECTS\";\n    ErrorCode[ErrorCode[\"VAST_NO_ADS_AFTER_WRAPPER\"] = 303] = \"VAST_NO_ADS_AFTER_WRAPPER\";\n    ErrorCode[ErrorCode[\"VIDEO_PLAY_ERROR\"] = 400] = \"VIDEO_PLAY_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_MEDIA_FILE_NOT_FOUND\"] = 401] = \"VAST_MEDIA_FILE_NOT_FOUND\";\n    ErrorCode[ErrorCode[\"VAST_MEDIA_LOAD_TIMEOUT\"] = 402] = \"VAST_MEDIA_LOAD_TIMEOUT\";\n    ErrorCode[ErrorCode[\"VAST_LINEAR_ASSET_MISMATCH\"] = 403] = \"VAST_LINEAR_ASSET_MISMATCH\";\n    ErrorCode[ErrorCode[\"VAST_PROBLEM_DISPLAYING_MEDIA_FILE\"] = 405] = \"VAST_PROBLEM_DISPLAYING_MEDIA_FILE\";\n    ErrorCode[ErrorCode[\"VAST_NONLINEAR_PLAYING_FAILED\"] = 500] = \"VAST_NONLINEAR_PLAYING_FAILED\";\n    ErrorCode[ErrorCode[\"VAST_NONLINEAR_DIMENSIONS_ERROR\"] = 501] = \"VAST_NONLINEAR_DIMENSIONS_ERROR\";\n    ErrorCode[ErrorCode[\"VAST_NONLINEAR_LOADING_FAILED\"] = 502] = \"VAST_NONLINEAR_LOADING_FAILED\";\n    ErrorCode[ErrorCode[\"VAST_NONLINEAR_ASSET_MISMATCH\"] = 503] = \"VAST_NONLINEAR_ASSET_MISMATCH\";\n    ErrorCode[ErrorCode[\"UNKNOWN_ERROR\"] = 900] = \"UNKNOWN_ERROR\";\n    ErrorCode[ErrorCode[\"VPAID_ERROR\"] = 901] = \"VPAID_ERROR\";\n})(ErrorCode || (ErrorCode = {}));\nexport const isVastErrorCode = (code) => Object.values(ErrorCode).includes(code);\n","/**\n * Interface for classes that may emit linear VAST events.\n *\n * @interface LinearEvents\n */\n/* eslint-disable import/no-unused-modules */\n/**\n * Fires when the the creative was played to the end at normal speed so that 100% of the creative was played.\n *\n * @event LinearEvents#complete\n */\nexport const complete = 'complete';\n/**\n * Fires when a user clicks the ad.\n *\n * @event LinearEvents#clickThrough\n */\nexport const clickThrough = 'clickThrough';\n/**\n * Fires when there was an error with the linear creative.\n *\n * @event LinearEvents#error\n */\nexport const error = 'error';\n/**\n * Fires when the creative played continuously for at least 25% of the total duration at normal speed.\n *\n * @event LinearEvents#firstQuartile\n */\nexport const firstQuartile = 'firstQuartile';\n/**\n * Fires when there was an impression of the linear creative.\n *\n * @event LinearEvents#impression\n */\nexport const impression = 'impression';\n/**\n * Fires when more than 50% of the creative is visible.\n *\n * @event LinearEvents#viewable\n */\nexport const viewable = 'viewable';\n/**\n * Fires when less than 50% of the creative is visible.\n *\n * @event LinearEvents#notViewable\n */\nexport const notViewable = 'notViewable';\n/**\n * Fires when there is no way to determine visibility of the creative.\n *\n * @event LinearEvents#viewUndetermined\n */\nexport const viewUndetermined = 'viewUndetermined';\n/**\n * Fires when the creative played continuously for at least 50% of the total duration at normal speed.\n *\n * @event LinearEvents#midpoint\n */\nexport const midpoint = 'midpoint';\n/**\n * Fires when the user activated the mute control and muted the creative.\n *\n * @event LinearEvents#mute\n */\nexport const mute = 'mute';\n/**\n * Optional metric that can capture all other user interactions under one metric such a s hover-overs, or custom clicks. It should NOT replace clickthrough events or other existing events like mute, unmute, pause, etc.\n *\n * @event LinearEvents#otherAdInteraction\n */\nexport const otherAdInteraction = 'otherAdInteraction';\n/**\n * Fires when the user clicked the pause control and stopped the creative.\n *\n * @event LinearEvents#pause\n */\nexport const pause = 'pause';\n/**\n * Fires when the user activated a control to reduce player to a smaller size. This event replaces the exitFullscreen event per the 2014 Digital Video In-Stream Ad Metric Definitions.\n *\n * @event LinearEvents#playerCollapse\n */\nexport const playerCollapse = 'playerCollapse';\n/**\n * Fires when the user activated a control to reduce player to a smaller size.\n *\n * @event LinearEvents#exitFullscreen\n */\nexport const exitFullscreen = 'exitFullscreen';\n/**\n * Fires when the user activated a control to extend the player to a larger size. This event replaces the fullscreen event per the 2014 Digital Video In-Stream Ad Metric Definitions.\n *\n * @event LinearEvents#playerExpand\n */\nexport const playerExpand = 'playerExpand';\n/**\n * Fires when the user activated a control to extend the player to a larger size. Only for VAST 3.\n *\n * @event LinearEvents#fullscreen\n */\nexport const fullscreen = 'fullscreen';\n/**\n * Fires when the creative played for a duration at normal speed that is equal to or greater than the value provided in an additional offset attribute for the <Tracking> element under Linear ads. Values can be time in the format HH:MM:SS or HH:MM:SS.mmm or a percentage value in the format n%.\n *\n * @event LinearEvents#progress\n */\nexport const progress = 'progress';\n/**\n * Fires when the user activated the resume control after the creative had been stopped or paused.\n *\n * @event LinearEvents#resume\n */\nexport const resume = 'resume';\n/**\n * Fires when the user activated the rewind control to access a previous point in the creative timeline.\n *\n * @event LinearEvents#rewind\n */\nexport const rewind = 'rewind';\n/**\n * Fires when the user activated a skip control to skip the creative.\n *\n * @event LinearEvents#skip\n */\nexport const skip = 'skip';\n/**\n * This event is used to indicate that an individual creative within the ad was loaded and playback began. As with creativeView, this event is another way of tracking creative playback.\n *\n * @event LinearEvents#start\n */\nexport const start = 'start';\n/**\n * Fires when the creative played continuously for at least 75% of the duration at normal speed.\n *\n * @event LinearEvents#thirdQuartile\n */\nexport const thirdQuartile = 'thirdQuartile';\n/**\n * Amount of video viewed at normal speed in seconds or other appropriate time-based units. If a rewind event occurs during play, time spent viewing may be calculated on total amount of video viewed at normal speed, which may include additional amounts of video viewed after rewinding. The offset attribute for the <Tracking> element under Linear ads may be used to track when time spent viewing meets the threshold. Otherwise, a macro may be provided so that the player may return a time value. VAST does not provide a standard macro for this value, so the involved parties must establish these parameters if this metric is to be used.\n *\n * @event LinearEvents#timeSpentViewing\n */\nexport const timeSpentViewing = 'timeSpentViewing';\n/**\n * Fires when the user activated the mute control and unmuted the creative.\n *\n * @event LinearEvents#unmute\n */\nexport const unmute = 'unmute';\n/**\n * Fires when the user clicked the creative icon.\n *\n * @event LinearEvents#iconClick\n */\nexport const iconClick = 'iconClick';\n/**\n * Fires when the user viewed the creative icon.\n *\n * @event LinearEvents#iconView\n */\nexport const iconView = 'iconView';\n/**\n * The viewer has chosen to close the linear ad unit. This is currently inuse by some of the largest mobile SDKs to mark the dismissal of the end card companion that follows the video, as well as a close of the video itself, if applicable\n *\n * @event LinearEvents#closeLinear\n */\nexport const closeLinear = 'closeLinear';\n/**\n * Not to be confused with an impression, this event indicates that an individual creative portion of the ad was viewed.\n *\n * @event LinearEvents#creativeView\n */\nexport const creativeView = 'creativeView';\n/* eslint-enable import/no-unused-modules */\nexport const linearEvents = {\n    clickThrough,\n    closeLinear,\n    complete,\n    creativeView,\n    error,\n    exitFullscreen,\n    firstQuartile,\n    fullscreen,\n    iconClick,\n    iconView,\n    impression,\n    midpoint,\n    mute,\n    notViewable,\n    otherAdInteraction,\n    pause,\n    playerCollapse,\n    playerExpand,\n    progress,\n    resume,\n    rewind,\n    skip,\n    start,\n    thirdQuartile,\n    timeSpentViewing,\n    unmute,\n    viewable,\n    viewUndetermined\n};\n","/**\n * Interface for classes that may emit non linear VAST events.\n *\n * @interface NonLinearEvents\n */\n/**\n * Fires when the user clicked or otherwise activated a control used to pause streaming content, which either expands the ad within the player’s viewable area or “takes-over” the streaming content area by launching an additional portion of the ad.\n *\n * @event NonLinearEvents#acceptInvitation\n */\nexport const acceptInvitation = 'acceptInvitation';\n/**\n * Fires when the user clicked or otherwise activated a control used to pause streaming content, which either expands the ad within the player’s viewable area or “takes-over” the streaming content area by launching an additional portion of the ad.\n *\n * @event NonLinearEvents#adCollapse\n */\nexport const adCollapse = 'adCollapse';\n/**\n * Fires when the user clicked or otherwise activated a control for removing the ad.\n *\n * @event NonLinearEvents#close\n */\nexport const close = 'close';\nexport const nonLinearEvents = {\n    acceptInvitation,\n    adCollapse,\n    close\n};\n","/**\n * XML node type\n */\nexport var NodeType;\n(function (NodeType) {\n    NodeType[\"CDATA\"] = \"cdata\";\n    NodeType[\"DOCUMENT\"] = \"document\";\n    NodeType[\"ELEMENT\"] = \"element\";\n    NodeType[\"TEXT\"] = \"text\";\n})(NodeType || (NodeType = {}));\n","import { NodeType } from '../../types';\nconst NODE_TYPE = {\n    1: NodeType.ELEMENT,\n    3: NodeType.TEXT,\n    4: NodeType.TEXT\n};\nconst DOCUMENT_TYPE = {\n    9: NodeType.DOCUMENT\n};\nconst getNodeType = (node) => {\n    var _a;\n    const nodeType = (_a = NODE_TYPE[node.nodeType]) !== null && _a !== void 0 ? _a : DOCUMENT_TYPE[node.nodeType];\n    if (!nodeType) {\n        throw new Error('Unsupported element type');\n    }\n    return nodeType;\n};\nconst getNodeAttributes = (node) => node.attributes.length === 0\n    ? undefined\n    : Object.fromEntries(Array.from(node.attributes).map((attribute) => {\n        var _a;\n        return [\n            attribute.nodeName,\n            (_a = attribute.nodeValue) !== null && _a !== void 0 ? _a : undefined\n        ];\n    }));\nconst getNodeText = (node) => { var _a; return (_a = node.nodeValue) === null || _a === void 0 ? void 0 : _a.replace('<![CDATA[', '').replace(']]>', '').trim(); };\nconst getNodeChildren = (node) => {\n    var _a, _b;\n    if (!node.hasChildNodes()) {\n        return;\n    }\n    const childNodes = Array.from(node.childNodes).filter((childNode) => Object.keys(NODE_TYPE).map(Number).includes(childNode.nodeType));\n    const elements = [];\n    for (const childNode of childNodes) {\n        const childElement = xmlToJson(childNode);\n        if (!(childNode instanceof Text) || ((_b = (_a = childElement.text) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) > 0) {\n            elements.push(childElement);\n        }\n    }\n    return elements;\n};\nexport const xmlToJson = (node) => {\n    const type = getNodeType(node);\n    const element = {\n        type\n    };\n    if (node instanceof Element) {\n        const attributes = getNodeAttributes(node);\n        if (attributes) {\n            element.attributes = attributes;\n        }\n        element.name = node.nodeName.toLowerCase();\n    }\n    else if (node instanceof Text || node instanceof CDATASection) {\n        element.text = getNodeText(node);\n    }\n    const children = getNodeChildren(node);\n    if (children) {\n        element.elements = children;\n    }\n    return element;\n};\n","const getChildren = (element) => { var _a; return (_a = element.elements) !== null && _a !== void 0 ? _a : []; };\nconst findChildByName = (element, childName) => getChildren(element).find(({ name = '' }) => name.toUpperCase() === childName.toUpperCase());\nconst filterChildrenByName = (element, childrenName) => getChildren(element).filter(({ name = '' }) => name.toUpperCase() === childrenName.toUpperCase());\n/**\n * Get the first child element from the passed parsed xml element.\n *\n * @param element Parsed xml element object.\n * @param childName Child element name\n * @returns The first child element with the passed name or undefined if not found.\n */\nexport const get = findChildByName;\n/**\n * Get all the children elements of the passed parsed xml element filtered by the passed child name if passed.\n *\n * @param element Parsed xml element object.\n * @param childName Child element name.\n * @returns Array of child elements or an empty array.\n */\nexport const getAll = (element, childName) => {\n    if (typeof childName === 'string') {\n        return filterChildrenByName(element, childName);\n    }\n    return getChildren(element);\n};\n/**\n * Get the first child element from the passed parsed xml element.\n *\n * @returns The first child element or undefined if there are non.\n */\nexport const getFirstChild = (element) => getChildren(element)[0];\n/**\n * Get the text value of the passed parsed xml element.\n *\n * @returns Text of the element\n */\nexport const getText = (element) => {\n    const firstChild = element && getFirstChild(element);\n    return firstChild && firstChild.text;\n};\n/**\n * Get all the attributes of the passed parsed xml element.\n *\n * @returns Object with the element attributes.\n */\nexport const getAttributes = (element) => { var _a; return (_a = element.attributes) !== null && _a !== void 0 ? _a : {}; };\n/**\n * Get the attribute with the passed name of the passed parsed xml element.\n *\n * @returns Attribute value or undefined.\n */\nexport const getAttribute = (element, attributeName) => getAttributes(element)[attributeName];\n","import { xml2js } from './helpers/xml2js';\nimport { get, getAll, getFirstChild, getText, getAttributes, getAttribute } from './helpers/xmlSelectors';\nconst parser = new DOMParser();\n/**\n * Parses the passed xml text.\n *\n * @throws if there is an error parsing the xml.\n * @param xmlText XML text to be parsed.\n * @returns Returns the parsed xml document as a js object.\n */\nexport const parseXml = (xmlText) => xml2js(parser, xmlText);\nexport { get, getAll, getFirstChild, getText, getAttributes, getAttribute };\n","const parseHoursToMs = (hourString) => Number(hourString) * 60 * 60 * 1000;\nconst parseMinToMs = (minString) => Number(minString) * 60 * 1000;\nconst parseSecToMs = (secString) => Number(secString) * 1000;\nexport const parseTime = (durationString) => {\n    if (typeof durationString === 'string') {\n        const durationRegex = /(\\d\\d):(\\d\\d):(\\d\\d)(\\.(\\d\\d\\d))?/;\n        const match = durationString.match(durationRegex);\n        if (match) {\n            const [, hours, minutes, seconds, , ms] = match;\n            const durationInMs = parseHoursToMs(hours) +\n                parseMinToMs(minutes) +\n                parseSecToMs(seconds) +\n                (ms ? Number(ms) : 0);\n            if (!isNaN(durationInMs)) {\n                return durationInMs;\n            }\n        }\n    }\n};\n","import { parseTime } from './parseTime';\nconst isPercentage = (offset) => {\n    const percentageRegex = /^\\d+(\\.\\d+)?%$/g;\n    return percentageRegex.test(offset);\n};\n// eslint-disable-next-line sonar/function-return-type\nexport const parseOffset = (offset) => {\n    if (isPercentage(offset)) {\n        return offset;\n    }\n    return parseTime(offset);\n};\n","import { get, getAll, getFirstChild } from '../../xml';\nconst hasLinear = (creative) => get(creative, 'linear');\nexport const getLinearCreative = (ad) => {\n    const adTypeElement = getFirstChild(ad);\n    const creativesElement = adTypeElement && get(adTypeElement, 'creatives');\n    return creativesElement && getAll(creativesElement).find(hasLinear);\n};\n","import { get, getAll, getText, getAttributes } from '../xml';\nimport { parseOffset } from './helpers/parseOffset';\nimport { getLinearCreative } from './helpers/getLinearCreative';\nconst getTrackingEvent = (trackingEventElement) => {\n    const { event, offset } = getAttributes(trackingEventElement);\n    const uri = getText(trackingEventElement);\n    return {\n        event,\n        offset: offset && parseOffset(offset),\n        uri\n    };\n};\n/**\n * Gets the Linear tracking events from the Vast Ad\n *\n * @param ad VAST ad object.\n * @param eventName If provided it will filter-out the array events against it.\n * @returns Array of Tracking event definitions\n */\nexport const getLinearTrackingEvents = (ad, eventName) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const linearElement = creativeElement && get(creativeElement, 'Linear');\n    const trackingEventsElement = linearElement && get(linearElement, 'TrackingEvents');\n    const trackingEventElements = trackingEventsElement && getAll(trackingEventsElement, 'Tracking');\n    if (trackingEventElements && trackingEventElements.length > 0) {\n        const trackingEvents = trackingEventElements.map(getTrackingEvent);\n        if (!eventName) {\n            return trackingEvents;\n        }\n        const filteredEvents = trackingEvents.filter(({ event }) => event === eventName);\n        if (filteredEvents.length > 0) {\n            return filteredEvents;\n        }\n    }\n};\n","import { get, getAll, getText, getAttributes } from '../xml';\nimport { getLinearCreative } from './helpers/getLinearCreative';\nimport { parseTime } from './helpers/parseTime';\nconst formatSize = (size) => {\n    const match = `${size}`.match(/\\d+/g);\n    return Number((match === null || match === void 0 ? void 0 : match[0]) || '');\n};\n// eslint-disable-next-line sonar/function-return-type\nconst formatPosition = (position) => {\n    const isNumberString = /\\d+/.test(position);\n    if (isNumberString) {\n        return formatSize(position);\n    }\n    return position;\n};\nconst getIconAttributes = (iconElement) => {\n    const { duration, height, offset, program, pxratio, width, xPosition = 'right', yPosition = 'top' } = getAttributes(iconElement);\n    return {\n        duration: (duration && parseTime(duration)) || undefined,\n        height: (height && formatSize(height)) || undefined,\n        offset: (offset && parseTime(offset)) || undefined,\n        program,\n        pxratio: (pxratio && parseInt(pxratio, 10)) || undefined,\n        width: (width && formatSize(width)) || undefined,\n        xPosition: xPosition && formatPosition(xPosition),\n        yPosition: yPosition && formatPosition(yPosition)\n    };\n};\nconst getIconResource = (iconElement) => {\n    const staticResourceElement = get(iconElement, 'StaticResource');\n    const htmlResourceElement = get(iconElement, 'HTMLResource');\n    const indexFrameResourceElement = get(iconElement, 'IFrameResource');\n    if (staticResourceElement) {\n        return { staticResource: getText(staticResourceElement) };\n    }\n    if (htmlResourceElement) {\n        return { htmlResource: getText(htmlResourceElement) };\n    }\n    if (indexFrameResourceElement) {\n        return { iFrameResource: getText(indexFrameResourceElement) };\n    }\n    return {\n        staticResource: getText(iconElement)\n    };\n};\nconst getIconViewTracking = (iconElement) => {\n    const iconTrackingElements = getAll(iconElement, 'IconViewTracking')\n        .map((iconViewTrackingElement) => getText(iconViewTrackingElement))\n        .filter(Boolean);\n    if (iconTrackingElements.length === 0) {\n        return {};\n    }\n    return {\n        iconViewTracking: iconTrackingElements\n    };\n};\nconst getIconClicks = (iconElement) => {\n    const iconClicksElement = get(iconElement, 'IconClicks');\n    const iconClickThroughElement = iconClicksElement && get(iconClicksElement, 'IconClickThrough');\n    const iconClickTrackingElements = iconClicksElement &&\n        getAll(iconClicksElement, 'IconClickTracking')\n            .map((iconClickTrackingElement) => getText(iconClickTrackingElement))\n            .filter(Boolean);\n    return {\n        iconClickThrough: iconClickThroughElement && getText(iconClickThroughElement),\n        iconClickTracking: iconClickTrackingElements && iconClickTrackingElements.length > 0\n            ? iconClickTrackingElements\n            : undefined\n    };\n};\n/**\n * Gets the Vast Icon definitions from the Vast Ad.\n *\n * @param ad VAST ad object.\n * @returns Array of VAST icon definitions\n */\nexport const getIcons = (ad) => {\n    const linearCreativeElement = ad && getLinearCreative(ad);\n    const linearElement = linearCreativeElement && get(linearCreativeElement, 'linear');\n    const iconsElement = linearElement && get(linearElement, 'Icons');\n    const iconElements = iconsElement && getAll(iconsElement, 'Icon');\n    if (iconElements && iconElements.length > 0) {\n        return iconElements.map((iconElement) => (Object.assign(Object.assign(Object.assign(Object.assign({}, getIconAttributes(iconElement)), getIconResource(iconElement)), getIconViewTracking(iconElement)), getIconClicks(iconElement))));\n    }\n};\n","import { get, getAll, getFirstChild, getText, getAttributes, getAttribute } from '../xml';\nimport { parseOffset } from './helpers/parseOffset';\nimport { getLinearCreative } from './helpers/getLinearCreative';\nimport { getLinearTrackingEvents } from './getLinearTrackingEvents';\nimport { getNonLinearTrackingEvents } from './getNonLinearTrackingEvents';\nimport { getIcons } from './getIcons';\nconst getBooleanValue = (value) => {\n    if (typeof value === 'string') {\n        return value === 'true';\n    }\n    return Boolean(value);\n};\nconst compareBySequence = (itemA, itemB) => {\n    const itemASequenceString = getAttribute(itemA, 'sequence');\n    const itemBSequenceString = getAttribute(itemB, 'sequence');\n    const itemASequence = itemASequenceString && parseInt(itemASequenceString, 10);\n    const itemBSequence = itemBSequenceString && parseInt(itemBSequenceString, 10);\n    if (typeof itemASequence !== 'string' || typeof itemBSequence !== 'string') {\n        return 0;\n    }\n    if (itemASequence < itemBSequence) {\n        return -1;\n    }\n    if (itemASequence > itemBSequence) {\n        return 1;\n    }\n    return 0;\n};\n/**\n * Selects the ads of the passed VAST.\n *\n * @param parsedVast Parsed VAST xml.\n * @returns Array of ads or empty array.\n */\nexport const getAds = (parsedVast) => {\n    const vastElement = parsedVast && get(parsedVast, 'VAST');\n    const ads = vastElement && getAll(vastElement, 'Ad');\n    if (ads && ads.length > 0) {\n        return ads;\n    }\n    return [];\n};\n/**\n * Gets the Error URI of the passed parsed VAST xml.\n *\n * @param parsedVast Parsed VAST xml.\n * @returns array of the Vast Error URI\n */\nexport const getVastErrorURI = (parsedVast) => {\n    const vastElement = parsedVast && get(parsedVast, 'VAST');\n    const errors = vastElement && getAll(vastElement, 'Error');\n    if (errors && errors.length > 0) {\n        return errors.map((error) => { var _a; return (_a = getText(error)) !== null && _a !== void 0 ? _a : ''; }).filter(Boolean);\n    }\n};\n/**\n * Gets the sequence of the pod ad.\n *\n * @param ad Parsed ad definition object.\n * @returns The pod ad sequence number.\n */\nexport const getPodAdSequence = (ad) => {\n    const sequenceString = getAttribute(ad, 'sequence');\n    const sequence = sequenceString && parseInt(sequenceString, 10);\n    if (typeof sequence === 'number' && !isNaN(sequence)) {\n        return sequence;\n    }\n};\n/**\n * Checks if the passed ad definition is a pod ad.\n *\n * @param ad Parsed ad definition object.\n * @returns Returns true if there the ad is a pod ad and false otherwise.\n */\nexport const isPodAd = (ad) => Boolean(getPodAdSequence(ad));\n/**\n * Checks if the passed array of ads have an ad pod.\n *\n * @param parsedVast Parsed VAST xml.\n * @returns Returns true if there is an ad pod in the array and false otherwise.\n */\nexport const hasAdPod = (parsedVast) => {\n    const ads = getAds(parsedVast);\n    return Array.isArray(ads) && ads.filter(isPodAd).length > 1;\n};\n/**\n * Returns true if the passed vastChain has an ad pod or false otherwise.\n *\n * @param vastChain Array of VAST responses. See `load` or `requestAd` for more info.\n * @returns True if the vastChain contains an ad pod and false otherwise.\n */\nexport const isAdPod = (vastChain = []) => vastChain.map(({ parsedXML }) => parsedXML).some(hasAdPod);\n/**\n * Selects the first ad of the passed VAST. If the passed VAST response contains an ad pod it will return the first ad in the ad pod sequence.\n *\n * @param parsedVast Parsed VAST xml.\n * @returns First ad of the VAST xml.\n */\nexport const getFirstAd = (parsedVast) => {\n    const ads = getAds(parsedVast);\n    if (Array.isArray(ads) && ads.length > 0) {\n        if (hasAdPod(parsedVast)) {\n            return ads.filter(isPodAd).sort(compareBySequence)[0];\n        }\n        return ads[0];\n    }\n};\n/**\n * Checks if the passed ad is a Wrapper.\n *\n * @param ad VAST ad object.\n * @returns `true` if the ad contains a wrapper and `false` otherwise.\n */\nexport const isWrapper = (ad) => Boolean(get(ad || {}, 'Wrapper'));\n/**\n * Checks if the passed ad is an Inline.\n *\n * @param ad VAST ad object.\n * @returns Returns `true` if the ad contains an Inline or `false` otherwise.\n */\nexport const isInline = (ad) => Boolean(get(ad || {}, 'Inline'));\n/**\n * Returns the VASTAdTagURI from the wrapper ad.\n *\n * @param ad VAST ad object.\n * @returns Returns the VASTAdTagURI from the wrapper ad.\n */\nexport const getVASTAdTagURI = (ad) => {\n    const wrapperElement = get(ad, 'Wrapper');\n    const vastAdTagURIElement = wrapperElement && get(wrapperElement, 'VastAdTagUri');\n    return vastAdTagURIElement && getText(vastAdTagURIElement);\n};\n/**\n * Returns the options from the wrapper ad.\n *\n * @param ad VAST ad object.\n * @returns Returns the options from the wrapper ad.\n */\nexport const getWrapperOptions = (ad) => {\n    const wrapperElement = get(ad, 'Wrapper');\n    const options = {};\n    if (wrapperElement) {\n        const { allowMultipleAds, fallbackOnNoAd, followAdditionalWrappers } = getAttributes(wrapperElement);\n        if (allowMultipleAds) {\n            options.allowMultipleAds = getBooleanValue(allowMultipleAds);\n        }\n        if (fallbackOnNoAd) {\n            options.fallbackOnNoAd = getBooleanValue(fallbackOnNoAd);\n        }\n        if (followAdditionalWrappers) {\n            options.followAdditionalWrappers = getBooleanValue(followAdditionalWrappers);\n        }\n    }\n    return options;\n};\n/**\n * Gets the Error URI of the passed ad.\n *\n * @param ad VAST ad object.\n * @returns array of the Vast ad Error URI.\n */\nexport const getAdErrorURI = (ad) => {\n    const adTypeElement = ad && getFirstChild(ad);\n    const errors = adTypeElement && getAll(adTypeElement, 'Error');\n    if (errors && errors.length > 0) {\n        return errors.map((error) => { var _a; return (_a = getText(error)) !== null && _a !== void 0 ? _a : ''; }).filter(Boolean);\n    }\n};\n/**\n * Gets array of the Impression URI of the passed ad.\n *\n * @param ad VAST ad object.\n * @returns array of the Vast ad Impression URI.\n */\nexport const getImpression = (ad) => {\n    const adTypeElement = ad && getFirstChild(ad);\n    const impressions = adTypeElement && getAll(adTypeElement, 'Impression');\n    if (impressions && impressions.length > 0) {\n        return impressions\n            .map((impression) => { var _a; return (_a = getText(impression)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets array of the Viewable URI of the passed ad.\n *\n * @param ad VAST ad object.\n * @returns array of the Vast ad Viewable URI.\n */\nexport const getViewable = (ad) => {\n    const adTypeElement = ad && getFirstChild(ad);\n    const viewableImpression = adTypeElement && get(adTypeElement, 'ViewableImpression');\n    const viewableElements = viewableImpression && getAll(viewableImpression, 'Viewable');\n    if (viewableElements && viewableElements.length > 0) {\n        return viewableElements\n            .map((element) => { var _a; return (_a = getText(element)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets array of the NotViewable URI of the passed ad.\n *\n * @param ad VAST ad object.\n * @returns array of the Vast ad NotViewable URI.\n */\nexport const getNotViewable = (ad) => {\n    const adTypeElement = ad && getFirstChild(ad);\n    const viewableImpression = adTypeElement && get(adTypeElement, 'ViewableImpression');\n    const notViewableElements = viewableImpression && getAll(viewableImpression, 'NotViewable');\n    if (notViewableElements && notViewableElements.length > 0) {\n        return notViewableElements\n            .map((element) => { var _a; return (_a = getText(element)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets array of the ViewUndetermined URI of the passed ad.\n *\n * @param ad VAST ad object.\n * @returns array of the Vast ad ViewUndetermined URI.\n */\nexport const getViewUndetermined = (ad) => {\n    const adTypeElement = ad && getFirstChild(ad);\n    const viewableImpression = adTypeElement && get(adTypeElement, 'ViewableImpression');\n    const viewUndeterminedElements = viewableImpression && getAll(viewableImpression, 'ViewUndetermined');\n    if (viewUndeterminedElements && viewUndeterminedElements.length > 0) {\n        return viewUndeterminedElements\n            .map((element) => { var _a; return (_a = getText(element)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets the ad's MediaFiles.\n *\n * @param ad VAST ad object.\n * @returns array of media files\n */\nexport const getMediaFiles = (ad) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const universalAdIdElement = creativeElement && get(creativeElement, 'UniversalAdId');\n    const universalAdId = universalAdIdElement && getText(universalAdIdElement);\n    const linearElement = creativeElement && get(creativeElement, 'Linear');\n    const mediaFilesElement = linearElement && get(linearElement, 'MediaFiles');\n    const mediaFileElements = mediaFilesElement && getAll(mediaFilesElement, 'MediaFile');\n    if (mediaFileElements && mediaFileElements.length > 0) {\n        return mediaFileElements.map((mediaFileElement) => {\n            const source = getText(mediaFileElement);\n            const { apiFramework, bitrate, codec, delivery, height, id, maintainAspectRatio, maxBitrate, minBitrate, scalable, type, width } = getAttributes(mediaFileElement);\n            return {\n                apiFramework,\n                bitrate,\n                codec,\n                delivery,\n                height,\n                id,\n                maintainAspectRatio,\n                maxBitrate,\n                minBitrate,\n                scalable,\n                src: source,\n                type,\n                universalAdId,\n                width\n            };\n        });\n    }\n};\n/**\n * Gets the ad's InteractiveFiles. That were added with the `InteractiveCreativeFile` tag.\n *\n * @param ad VAST ad object.\n * @returns array of media files.\n */\nexport const getInteractiveCreativeFiles = (ad) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const linearElement = creativeElement && get(creativeElement, 'Linear');\n    const mediaFilesElement = linearElement && get(linearElement, 'MediaFiles');\n    const interactiveElements = mediaFilesElement && getAll(mediaFilesElement, 'InteractiveCreativeFile');\n    if (interactiveElements && interactiveElements.length > 0) {\n        return interactiveElements.map((interactiveElement) => {\n            const { apiFramework, type } = getAttributes(interactiveElement);\n            const source = getText(interactiveElement);\n            return {\n                apiFramework,\n                src: source,\n                type\n            };\n        });\n    }\n};\n/**\n * Gets all the ad's InteractiveFiles.\n *\n * @param ad VAST ad object.\n * @returns array of media files\n */\nexport const getInteractiveFiles = (ad) => {\n    let interactiveFiles = getInteractiveCreativeFiles(ad);\n    if (interactiveFiles) {\n        return interactiveFiles;\n    }\n    const mediaFiles = getMediaFiles(ad);\n    if (mediaFiles) {\n        interactiveFiles = mediaFiles\n            .filter(({ apiFramework = '' }) => (apiFramework === null || apiFramework === void 0 ? void 0 : apiFramework.toLowerCase()) === 'vpaid')\n            .map(({ apiFramework, src: source, type }) => ({\n            apiFramework,\n            src: source,\n            type\n        }));\n        if (interactiveFiles.length > 0) {\n            return interactiveFiles;\n        }\n    }\n};\nconst getVideoClicksElement = (ad) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const linearElement = creativeElement && get(creativeElement, 'Linear');\n    return linearElement && get(linearElement, 'VideoClicks');\n};\n/**\n * Gets the click through {@link VastMacro}.\n *\n * @param ad VAST ad object.\n * @returns clickthrough macro\n */\nexport const getClickThrough = (ad) => {\n    const videoClicksElement = getVideoClicksElement(ad);\n    const clickThroughElement = videoClicksElement && get(videoClicksElement, 'ClickThrough');\n    return clickThroughElement && getText(clickThroughElement);\n};\n/**\n * Gets the click through {@link VastMacro}.\n *\n * @param ad VAST ad object.\n * @returns click tracking macro\n */\nexport const getClickTracking = (ad) => {\n    const videoClicksElement = ad && getVideoClicksElement(ad);\n    const clickTrackingElements = videoClicksElement && getAll(videoClicksElement, 'ClickTracking');\n    if (clickTrackingElements && clickTrackingElements.length > 0) {\n        return clickTrackingElements\n            .map((element) => { var _a; return (_a = getText(element)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets the custom click {@link VastMacro}.\n *\n * @param ad VAST ad object.\n * @returns click tracking macro\n */\nexport const getCustomClick = (ad) => {\n    const videoClicksElement = getVideoClicksElement(ad);\n    const customClickElements = videoClicksElement && getAll(videoClicksElement, 'CustomClick');\n    if (customClickElements && customClickElements.length > 0) {\n        return customClickElements\n            .map((element) => { var _a; return (_a = getText(element)) !== null && _a !== void 0 ? _a : ''; })\n            .filter(Boolean);\n    }\n};\n/**\n * Gets the skipoffset.\n *\n * @param ad VAST ad object.\n * @returns the time offset in milliseconds or a string with the percentage\n */\nexport const getSkipOffset = (ad) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const linearElement = creativeElement && get(creativeElement, 'Linear');\n    const skipoffset = linearElement && getAttribute(linearElement, 'skipoffset');\n    return skipoffset && parseOffset(skipoffset);\n};\nconst getLinearContent = (xml) => {\n    const linearRegex = /<Linear([\\s\\S]*)<\\/Linear/gm;\n    const result = linearRegex.exec(xml);\n    return result === null || result === void 0 ? void 0 : result[1];\n};\nconst getAdParametersContent = (xml) => {\n    const paramsRegex = /<AdParameters[\\s\\w=\"]*>([\\s\\S]*)<\\/AdParameters>/gm;\n    const result = paramsRegex.exec(xml);\n    return (result === null || result === void 0 ? void 0 : result[1].replace(/[\\n\\s]*<!\\[CDATA\\[[\\n\\s]*/, '').replace(/[\\n\\s]*\\]\\]>[\\n\\s]*$/, '').replace(/\\]\\]\\]\\]><!\\[CDATA\\[>/, ']]>').trim());\n};\nconst getXmlEncodedValue = (xml) => {\n    const xmlEncodedRegex = /<AdParameters[\\s]*xmlEncoded=\"(.*?)\">/gim;\n    const result = xmlEncodedRegex.exec(xml);\n    return (result === null || result === void 0 ? void 0 : result[1]) === 'true';\n};\n/**\n * Gets the creative data.\n *\n * @param xml VAST XML text.\n * @returns with `AdParameters` as they come in the XML and a flag `xmlEncoded` to indicate if the ad parameters are xml encoded.\n */\nexport const getCreativeData = (xml) => {\n    const linearContent = getLinearContent(xml);\n    const AdParameters = linearContent && getAdParametersContent(linearContent);\n    const xmlEncoded = linearContent ? getXmlEncodedValue(linearContent) : false;\n    return {\n        AdParameters,\n        xmlEncoded\n    };\n};\nexport { getIcons, getLinearTrackingEvents, getNonLinearTrackingEvents };\n","import { parseMacro } from './parseMacro';\n/**\n * Creates a tracking image with the passed URL macro.\n *\n * @param urlMacro URL Macro that need to be tracked.\n * @param data Data Object with the macros's variables.\n * @returns Image element whose source is the parsed URL Macro.\n */\nexport const pixelTracker = (urlMacro, data) => {\n    const img = new Image();\n    img.src = parseMacro(urlMacro, data);\n    return img;\n};\n","const toUpperKeys = (map) => {\n    const upperKeysMap = {};\n    Object.keys(map).forEach((key) => {\n        const { [key]: value } = map;\n        upperKeysMap[key.toUpperCase()] = value;\n    });\n    return upperKeysMap;\n};\nconst CACHEBUSTING_MAX = 1.0e10;\n/**\n * Parses the passed macro with the passed data and returns the resulting parsed Macro.\n * If no CACHEBUSTING property is passed in the data it will generate a random one on its own.\n * If no TIMESTAMP property is passed in the data it will generate a one on its own.\n *\n * @param macro The string macro to be parsed.\n * @param data The data used by the macro.\n * @returns The parsed macro.\n */\nexport const parseMacro = (macro, data = {}) => {\n    let parsedMacro = macro;\n    const macroData = toUpperKeys(data);\n    if (!macroData.CACHEBUSTING) {\n        macroData.CACHEBUSTING = Math.round(Math.random() * CACHEBUSTING_MAX);\n    }\n    if (!macroData.TIMESTAMP) {\n        macroData.TIMESTAMP = new Date().toISOString();\n    }\n    Object.keys(macroData).forEach((key) => {\n        const value = encodeURIComponent(macroData[key]);\n        parsedMacro = parsedMacro.replace(\n        // eslint-disable-next-line security/detect-non-literal-regexp\n        new RegExp(`\\\\[${key}\\\\]`, 'gm'), value);\n    });\n    return parsedMacro;\n};\n","import { getAdErrorURI, getVastErrorURI } from '../../vastSelectors';\nimport { pixelTracker } from './pixelTracker';\n/**\n * Tracks an error.\n *\n * @param vastChain the ad VAST Chain.\n * @param options Options Map\n */\nexport const trackError = (vastChain, { errorCode, tracker = pixelTracker }) => {\n    vastChain.forEach(({ ad, parsedXML }) => {\n        const errorURIs = (ad && getAdErrorURI(ad)) || getVastErrorURI(parsedXML);\n        errorURIs === null || errorURIs === void 0 ? void 0 : errorURIs.forEach((uri) => uri && tracker(uri, { errorCode }));\n    });\n};\n","import { pixelTracker } from './pixelTracker';\nexport const createVastEventTracker = (trackingEventSelector) => (vastChain, { data = {}, tracker = pixelTracker }) => {\n    vastChain.forEach(({ ad }) => {\n        const value = ad && trackingEventSelector(ad);\n        if (!value) {\n            return;\n        }\n        if (value && typeof value === 'string') {\n            tracker(value, data);\n            return;\n        }\n        if (Array.isArray(value)) {\n            value.map(({ uri }) => uri && tracker(uri, data));\n        }\n    });\n};\n","import { getClickTracking, getCustomClick, getImpression, getViewable, getNotViewable, getViewUndetermined, getLinearTrackingEvents } from '../vastSelectors';\nimport { pixelTracker } from './helpers/pixelTracker';\nimport { trackError } from './helpers/trackError';\nimport { trackIconView } from './helpers/trackIconView';\nimport { trackIconClick } from './helpers/trackIconClick';\nimport { trackProgress } from './helpers/trackProgress';\nimport { createVastEventTracker } from './helpers/createVastEventTracker';\nimport { clickThrough, closeLinear, complete, error, exitFullscreen, firstQuartile, fullscreen, iconClick, iconView, impression, viewable, notViewable, viewUndetermined, midpoint, mute, pause, playerCollapse, playerExpand, progress, resume, rewind, skip, start, thirdQuartile, unmute, creativeView } from './linearEvents';\nconst eventSelector = (...selectors) => (ad) => {\n    const trackingURIs = [];\n    if (selectors.length > 0) {\n        selectors.forEach((getElements) => {\n            const elements = getElements(ad);\n            /* istanbul ignore else */\n            if (Array.isArray(elements) && elements.length > 0) {\n                trackingURIs.push(...elements.map((uri) => ({ uri })));\n            }\n        });\n    }\n    return trackingURIs;\n};\nconst linearTrackingEventSelector = (event) => (ad) => getLinearTrackingEvents(ad, event);\nconst linearTrackers = {\n    [clickThrough]: createVastEventTracker(eventSelector(getClickTracking, getCustomClick)),\n    [closeLinear]: createVastEventTracker(linearTrackingEventSelector(closeLinear)),\n    [complete]: createVastEventTracker(linearTrackingEventSelector(complete)),\n    [creativeView]: createVastEventTracker(linearTrackingEventSelector(creativeView)),\n    [error]: trackError,\n    [exitFullscreen]: createVastEventTracker(linearTrackingEventSelector(exitFullscreen)),\n    [firstQuartile]: createVastEventTracker(linearTrackingEventSelector(firstQuartile)),\n    [fullscreen]: createVastEventTracker(linearTrackingEventSelector(fullscreen)),\n    [iconClick]: trackIconClick,\n    [iconView]: trackIconView,\n    [impression]: createVastEventTracker(eventSelector(getImpression)),\n    [midpoint]: createVastEventTracker(linearTrackingEventSelector(midpoint)),\n    [mute]: createVastEventTracker(linearTrackingEventSelector(mute)),\n    [notViewable]: createVastEventTracker(eventSelector(getNotViewable)),\n    [pause]: createVastEventTracker(linearTrackingEventSelector(pause)),\n    [playerCollapse]: createVastEventTracker(linearTrackingEventSelector(playerCollapse)),\n    [playerExpand]: createVastEventTracker(linearTrackingEventSelector(playerExpand)),\n    [progress]: trackProgress,\n    [resume]: createVastEventTracker(linearTrackingEventSelector(resume)),\n    [rewind]: createVastEventTracker(linearTrackingEventSelector(rewind)),\n    [skip]: createVastEventTracker(linearTrackingEventSelector(skip)),\n    [start]: createVastEventTracker(linearTrackingEventSelector(start)),\n    [thirdQuartile]: createVastEventTracker(linearTrackingEventSelector(thirdQuartile)),\n    [unmute]: createVastEventTracker(linearTrackingEventSelector(unmute)),\n    [viewable]: createVastEventTracker(eventSelector(getViewable)),\n    [viewUndetermined]: createVastEventTracker(eventSelector(getViewUndetermined))\n};\n/**\n * Tracks the passed linear event.\n *\n * @param event name of the linear event we need to track. @see LinearEvents\n * @param vastChain the ad VAST Chain.\n * @param options Options Map. The allowed properties are:\n */\nexport const trackLinearEvent = (event, vastChain, { data, errorCode, tracker = pixelTracker, logger = console }) => {\n    const { [event]: linearTracker } = linearTrackers;\n    if (linearTracker) {\n        linearTracker(vastChain, {\n            data: Object.assign(Object.assign({}, data), { errorCode }),\n            errorCode,\n            tracker\n        });\n    }\n    else {\n        logger.error(`Event '${event}' cannot be tracked`);\n    }\n};\n","import { pixelTracker } from './pixelTracker';\nexport const trackIconClick = (_vastChain, { data = {}, tracker = pixelTracker }) => {\n    const { iconClickTracking } = data;\n    if (Array.isArray(iconClickTracking)) {\n        for (const trackUrl of iconClickTracking) {\n            tracker(trackUrl, Object.assign({}, data));\n        }\n    }\n};\n","import { pixelTracker } from './pixelTracker';\nexport const trackIconView = (_vastChain, { data = {}, tracker = pixelTracker }) => {\n    const { iconViewTracking } = data;\n    if (Array.isArray(iconViewTracking)) {\n        for (const trackUrl of iconViewTracking) {\n            tracker(trackUrl, Object.assign({}, data));\n        }\n    }\n};\n","import { pixelTracker } from './pixelTracker';\nexport const trackProgress = (_vastChain, { data = {}, tracker = pixelTracker }) => {\n    const { progressUri } = data;\n    if (progressUri) {\n        tracker(progressUri, Object.assign({}, data));\n    }\n};\n","import { getNonLinearTrackingEvents } from '../vastSelectors';\nimport { createVastEventTracker } from './helpers/createVastEventTracker';\nimport { pixelTracker } from './helpers/pixelTracker';\nimport { acceptInvitation, adCollapse, close } from './nonLinearEvents';\nconst trackingEventSelector = (event) => (ad) => getNonLinearTrackingEvents(ad, event);\nconst linearTrackers = {\n    [acceptInvitation]: createVastEventTracker(trackingEventSelector(acceptInvitation)),\n    [adCollapse]: createVastEventTracker(trackingEventSelector(adCollapse)),\n    [close]: createVastEventTracker(trackingEventSelector(close))\n};\n/**\n * Tracks the passed non linear event.\n *\n * @param event name of the linear event we need to track. @see LinearEvents\n * @param vastChain the ad VAST Chain.\n * @param options Options Map.\n */\nexport const trackNonLinearEvent = (event, vastChain, { data, tracker = pixelTracker, logger = console }) => {\n    const { [event]: linearTracker } = linearTrackers;\n    if (linearTracker) {\n        linearTracker(vastChain, {\n            data: Object.assign({}, data),\n            tracker\n        });\n    }\n    else {\n        logger.error(`Event '${event}' cannot be tracked`);\n    }\n};\n","import { get, getAll, getText, getAttributes } from '../xml';\nimport { getLinearCreative } from './helpers/getLinearCreative';\n/**\n * Gets the Non Linear tracking events from the Vast Ad\n *\n * @param ad VAST ad object.\n * @param eventName If provided it will filter-out the array events against it.\n * @returns Array of Tracking event definitions\n */\nexport const getNonLinearTrackingEvents = (ad, eventName) => {\n    const creativeElement = ad && getLinearCreative(ad);\n    const nonLinearAdsElement = creativeElement && get(creativeElement, 'NonLinearAds');\n    const trackingEventsElement = nonLinearAdsElement && get(nonLinearAdsElement, 'TrackingEvents');\n    const trackingEventElements = trackingEventsElement && getAll(trackingEventsElement, 'Tracking');\n    if (trackingEventElements && trackingEventElements.length > 0) {\n        const trackingEvents = trackingEventElements.map((trackingEventElement) => {\n            const { event } = getAttributes(trackingEventElement);\n            const uri = getText(trackingEventElement);\n            return {\n                event,\n                uri\n            };\n        });\n        if (!eventName) {\n            return trackingEvents;\n        }\n        const filteredEvents = trackingEvents.filter(({ event }) => event === eventName);\n        if (filteredEvents.length > 0) {\n            return filteredEvents;\n        }\n    }\n};\n","export const getContentDocument = (iframeElement) => iframeElement.contentDocument ||\n    /* istanbul ignore next */\n    (iframeElement.contentWindow && iframeElement.contentWindow.document);\n","const supported = 'srcdoc' in document.createElement('iframe');\nexport const supportsSrcdoc = () => supported;\n","import { getContentDocument } from './getContentDocument';\nimport { getOrigin } from './getOrigin';\nimport { supportsSrcdoc } from './supportsSrcdoc';\nconst iframeContent = (id, targetOrigin) => `<!DOCTYPE html>\n<html>\n  <head><meta charset='UTF-8'></head>\n  <body style='margin:0;padding:0'>\n  <script type='text/javascript'>window.parent.postMessage('${id}_ready', '${targetOrigin}');</script>\n  </body>\n</html>`;\nconst createBaseIframe = () => {\n    const iframe = document.createElement('iframe');\n    iframe.setAttribute('sandbox', 'allow-forms allow-popups allow-scripts allow-same-origin');\n    iframe.setAttribute('loading', 'eager');\n    iframe.style.margin = '0';\n    iframe.style.padding = '0';\n    iframe.style.border = 'none';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.position = 'absolute';\n    return iframe;\n};\nexport const createIframe = (placeholder, id) => new Promise((resolve, reject) => {\n    const content = iframeContent(id, getOrigin());\n    let iframe = createBaseIframe();\n    // NOTE: favor about:blank instead of srcdoc because some browsers\n    try {\n        iframe.src = 'about:blank';\n        placeholder.appendChild(iframe);\n        const contentDocument = getContentDocument(iframe);\n        if (!contentDocument) {\n            throw new TypeError('iframe content document is not a Document');\n        }\n        contentDocument.write(content);\n    }\n    catch (error) {\n        placeholder.removeChild(iframe);\n        if (supportsSrcdoc()) {\n            iframe = createBaseIframe();\n            iframe.src = 'about:srcdoc';\n            iframe.srcdoc = content;\n            placeholder.appendChild(iframe);\n        }\n        else {\n            reject(error);\n        }\n    }\n    const handleMessage = ({ data }) => {\n        /* istanbul ignore else */\n        if (data === `${id}_ready`) {\n            window.removeEventListener('message', handleMessage);\n            resolve(iframe);\n        }\n    };\n    window.addEventListener('message', handleMessage, false);\n});\n","var _a;\nimport { loadScript } from './helpers/loadScript';\nimport { createAdVideoElement } from './helpers/createAdVideoElement';\nimport { createAdContainer } from './helpers/createAdContainer';\nimport { createIframe } from './helpers/createIframe';\nimport { createSlot } from './helpers/createSlot';\nimport { getContentDocument } from './helpers/getContentDocument';\nimport { unique } from './helpers/unique';\nconst nextId = unique('videoAdContainer');\nconst hidden = Symbol('hidden');\n/**\n * This class provides everything necessary to contain and create a video ad within a given placeholder Element.\n */\nexport class VideoAdContainer {\n    /**\n     * Creates a VideoAdContainer.\n     *\n     * @param placeholder DIV that will contain the ad.\n     * @param videoElement optional videoElement that will be used to play the ad.\n     */\n    constructor(placeholder, videoElement) {\n        this[_a] = {\n            destroyed: false,\n            id: nextId(),\n            iframe: undefined,\n            readyPromise: undefined\n        };\n        if (!(placeholder instanceof Element)) {\n            throw new TypeError('placeholder is not an Element');\n        }\n        this.element = createAdContainer();\n        this.isOriginalVideoElement = Boolean(videoElement);\n        if (videoElement) {\n            this.videoElement = videoElement;\n        }\n        else {\n            this.videoElement = createAdVideoElement();\n            this.element.appendChild(this.videoElement);\n        }\n        placeholder.appendChild(this.element);\n    }\n    /**\n     * Adds the passed script to the ad container.\n     *\n     * @param src script source uri.\n     * @param options Options map.\n     */\n    async addScript(source, options = {}) {\n        var _b;\n        if (this.isDestroyed()) {\n            throw new Error('VideoAdContainer has been destroyed');\n        }\n        let { iframe } = this[hidden];\n        if (!iframe) {\n            iframe = await createIframe(this.element, this[hidden].id);\n            this[hidden].iframe = iframe;\n            this.executionContext = iframe.contentWindow;\n        }\n        const placeholder = (_b = getContentDocument(iframe)) === null || _b === void 0 ? void 0 : _b.body;\n        return loadScript(source, Object.assign({ placeholder }, options));\n    }\n    /**\n     * Adds the slot to the ad container.\n     *\n     * @param width - Slot width.\n     * @param height - Slot height.\n     */\n    addSlot(width, height) {\n        if (this.isDestroyed()) {\n            throw new Error('VideoAdContainer has been destroyed');\n        }\n        if (!this.slotElement) {\n            this.slotElement = createSlot(this.element, width, height);\n        }\n    }\n    /**\n     * Destroys the VideoAdContainer.\n     */\n    destroy() {\n        // NOTE: calling destroy immediately terminates the iframe and cancels\n        //       tracking requests from vpaid script, so destroying should\n        //       immediately hides and remove the iframe from dom after timeout\n        const removePromise = new Promise((resolve) => {\n            setTimeout(() => {\n                var _b;\n                (_b = this.element.parentNode) === null || _b === void 0 ? void 0 : _b.removeChild(this.element);\n                resolve();\n            }, 1000);\n        });\n        this.element.style.zIndex = '-9999';\n        this[hidden].destroyed = true;\n        return removePromise;\n    }\n    /**\n     * Checks if the container is destroyed.\n     *\n     * @returns true if the container is destroyed and false otherwise.\n     */\n    isDestroyed() {\n        return this[hidden].destroyed;\n    }\n}\n_a = hidden;\n","/**\n * unique will create a unique string every time is called, sequentially and namespaced\n *\n * @ignore\n * @param namespace\n */\nexport const unique = (namespace) => {\n    let count = -1;\n    return () => `${namespace}_${++count}`;\n};\n","export const createAdContainer = () => {\n    const adContainer = document.createElement('div');\n    adContainer.classList.add('mol-video-ad-container');\n    adContainer.style.width = '100%';\n    adContainer.style.height = '100%';\n    return adContainer;\n};\n","export const createAdVideoElement = (contentDocument = document) => {\n    const video = contentDocument.createElement('video');\n    video.style.width = '100%';\n    video.style.height = '100%';\n    return video;\n};\n","export const getOrigin = () => {\n    const { origin, protocol, hostname, port } = window.location;\n    /* istanbul ignore else */\n    if (origin) {\n        return origin;\n    }\n    const resultPort = port ? `:${port}` : '';\n    return `${protocol}//${hostname}${resultPort}`;\n};\n","/**\n * Loads the script source.\n *\n * @ignore\n * @param src The script source.\n * @param options The allowed options\n */\nexport const loadScript = (source, { async = false, defer = false, type, placeholder } = {}) => {\n    if (!source) {\n        throw new TypeError('Missing required \"src\" parameter');\n    }\n    return new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        let scriptPlaceholder = placeholder;\n        script.type = type !== null && type !== void 0 ? type : 'text/javascript';\n        script.async = async;\n        script.defer = defer;\n        script.onerror = () => reject(new URIError(`The script ${source} is not accessible.`));\n        script.onload = () => resolve(script);\n        if (!scriptPlaceholder) {\n            scriptPlaceholder = (document.currentScript\n                ? /* istanbul ignore next */\n                    document.currentScript.parentNode\n                : document.head);\n        }\n        script.src = source;\n        scriptPlaceholder === null || scriptPlaceholder === void 0 ? void 0 : scriptPlaceholder.appendChild(script);\n    });\n};\n","export const createSlot = (placeholder, width, height) => {\n    const slot = document.createElement('DIV');\n    Object.assign(slot.style, {\n        border: '0px',\n        cursor: 'pointer',\n        height: `${height}px`,\n        left: '0px',\n        margin: '0px',\n        padding: '0px',\n        position: 'absolute',\n        top: '0px',\n        width: `${width}px`\n    });\n    placeholder.appendChild(slot);\n    return slot;\n};\n","import { VideoAdContainer } from './VideoAdContainer';\n/**\n * VideoAdContainer factory method. Returns a VideoAdContainer instance that will contain the video ad.\n *\n * @ignore\n * @param placeholder Placeholder element that will contain the video ad.\n * @param videoElement Optional videoElement that will be used to play the ad.\n *\n * @returns Returns a `VideoAdContainer` instance.\n */\nexport const createVideoAdContainer = (placeholder, videoElement) => {\n    if (!placeholder) {\n        throw new TypeError('placeholder is required');\n    }\n    return new VideoAdContainer(placeholder, videoElement);\n};\n","const mimeMap = {\n    '3gp': 'video/3gpp',\n    avi: 'video/x-msvideo',\n    flv: 'video/x-flv',\n    m3u8: 'application/x-mpegURL',\n    m4v: 'video/mp4',\n    mov: 'video/quicktime',\n    mp4: 'video/mp4',\n    mpd: 'application/dash+xml',\n    ogv: 'video/ogg',\n    ts: 'video/MP2T',\n    webm: 'video/webm',\n    wmv: 'video/x-ms-wmv'\n};\nexport const guessMimeType = (source) => {\n    const match = source.match(/\\.([^./?]+)(\\?[^/]+)?$/i);\n    const extension = match && match[1];\n    return (extension && mimeMap[extension]) || `video/${extension}`;\n};\n","import { guessMimeType } from './guessMimeType';\nexport const canPlay = (videoElement, mediaFile) => {\n    const { src: source, type } = mediaFile;\n    return videoElement.canPlayType(type || guessMimeType(source || ''));\n};\n","const APPROXIMATION_LAPSE = 10;\nconst getRectParams = (rect) => {\n    const width = Number(rect.width) || 0;\n    const height = Number(rect.height) || 0;\n    // NOTE: leaving 1 digit after the decimal point to handle\n    //       approximately equal ratios, because aspect ratio\n    //       of 480p (854x480) don't strict equal to 360p (640x360)\n    const aspectRatio = height\n        ? Math.floor((width / height) * APPROXIMATION_LAPSE) / APPROXIMATION_LAPSE\n        : 0;\n    return {\n        aspectRatio,\n        height,\n        width\n    };\n};\nexport const sortMediaByBestFit = (mediaFiles, screenRect) => {\n    const screenParams = getRectParams(screenRect);\n    const compareTo = (mediaFileA, mediaFileB) => {\n        const mediaFileAParams = getRectParams(mediaFileA);\n        const mediaFileBParams = getRectParams(mediaFileB);\n        const widthDeltaA = Math.abs(screenParams.width - mediaFileAParams.width);\n        const widthDeltaB = Math.abs(screenParams.width - mediaFileBParams.width);\n        const aspectRatioDeltaA = Math.abs(screenParams.aspectRatio - mediaFileAParams.aspectRatio);\n        const aspectRatioDeltaB = Math.abs(screenParams.aspectRatio - mediaFileBParams.aspectRatio);\n        return aspectRatioDeltaA - aspectRatioDeltaB || widthDeltaA - widthDeltaB;\n    };\n    return mediaFiles.slice(0).sort(compareTo);\n};\n","import { getMediaFiles } from '../../../vastSelectors';\nimport { canPlay } from './canPlay';\nimport { sortMediaByBestFit } from './sortMediaByBestFit';\nconst getMediaByDefaultBestFit = (mediaFiles, screenRect) => {\n    const [mediaFile] = sortMediaByBestFit(mediaFiles, screenRect);\n    return mediaFile;\n};\nexport const findBestMedia = (inlineAd, videoAdContainer, { getMediaFile = getMediaByDefaultBestFit }) => {\n    const { element, videoElement } = videoAdContainer;\n    const screenRect = element.getBoundingClientRect();\n    const mediaFiles = getMediaFiles(inlineAd);\n    const supportedMediaFiles = mediaFiles === null || mediaFiles === void 0 ? void 0 : mediaFiles.filter((mediaFile) => canPlay(videoElement, mediaFile));\n    return supportedMediaFiles && getMediaFile(supportedMediaFiles, screenRect);\n};\n","export const once = (element, eventName, listener) => {\n    const handler = (...args) => {\n        element.removeEventListener(eventName, handler);\n        return listener(...args);\n    };\n    element.addEventListener(eventName, handler);\n    return () => {\n        element.removeEventListener(eventName, handler);\n    };\n};\n","import { getLinearTrackingEvents } from '../../../vastSelectors';\nimport { linearEvents } from '../../../tracker';\nconst { progress } = linearEvents;\nexport const getProgressEvents = (vastChain) => vastChain\n    .map(({ ad }) => ad)\n    .reduce((accumulated, ad) => {\n    const events = (ad && getLinearTrackingEvents(ad, progress)) || [];\n    return [...accumulated, ...events];\n}, [])\n    .map(({ offset, uri }) => ({\n    offset,\n    uri\n}));\n","export const safeCallback = (callback, logger) => (...args) => {\n    try {\n        callback(...args);\n    }\n    catch (error) {\n        logger === null || logger === void 0 ? void 0 : logger.error(error);\n    }\n};\n","import { linearEvents } from '../../../../tracker';\nconst fullscreenElement = () => document.fullscreenElement ||\n    document.webkitFullscreenElement ||\n    document.mozFullScreenElement ||\n    document.msFullscreenElement ||\n    null;\nconst { fullscreen, exitFullscreen, playerCollapse, playerExpand } = linearEvents;\nexport const onFullscreenChange = ({ videoElement }, callback) => {\n    const fullscreenEventNames = [\n        'webkitfullscreenchange',\n        'mozfullscreenchange',\n        'fullscreenchange',\n        'MSFullscreenChange'\n    ];\n    let fullscreenOn = false;\n    const fullscreenchangeHandler = () => {\n        if (fullscreenElement() === videoElement) {\n            fullscreenOn = true;\n            callback(playerExpand);\n            callback(fullscreen);\n        }\n        else if (fullscreenOn) {\n            fullscreenOn = false;\n            callback(playerCollapse);\n            callback(exitFullscreen);\n        }\n    };\n    for (const event of fullscreenEventNames) {\n        document.addEventListener(event, fullscreenchangeHandler);\n    }\n    return () => {\n        for (const event of fullscreenEventNames) {\n            document.removeEventListener(event, fullscreenchangeHandler);\n        }\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nconst { pause, resume } = linearEvents;\nexport const onPlayPause = ({ videoElement }, callback) => {\n    let started = false;\n    let paused = true;\n    const playHandler = () => {\n        if (!started) {\n            started = true;\n            paused = false;\n        }\n        else if (paused) {\n            paused = false;\n            callback(resume);\n        }\n    };\n    const pauseHandler = () => {\n        if (!paused) {\n            paused = true;\n            callback(pause);\n        }\n    };\n    videoElement.addEventListener('play', playHandler);\n    videoElement.addEventListener('pause', pauseHandler);\n    return () => {\n        videoElement.removeEventListener('play', playHandler);\n        videoElement.removeEventListener('pause', pauseHandler);\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nconst { rewind } = linearEvents;\nexport const onRewind = ({ videoElement }, callback) => {\n    let { currentTime } = videoElement;\n    const timeupdateHandler = () => {\n        const delta = videoElement.currentTime - currentTime;\n        if (delta < 0 && Math.abs(delta) >= 1) {\n            callback(rewind);\n        }\n        currentTime = videoElement.currentTime;\n    };\n    videoElement.addEventListener('timeupdate', timeupdateHandler);\n    return () => {\n        videoElement.removeEventListener('timeupdate', timeupdateHandler);\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nconst { skip } = linearEvents;\nconst createDefaultSkipControl = () => {\n    const skipButton = document.createElement('button');\n    skipButton.classList.add('mol-vast-skip-control');\n    skipButton.type = 'button';\n    skipButton.innerHTML = 'skip';\n    skipButton.style.position = 'absolute';\n    skipButton.style.bottom = '15px';\n    skipButton.style.right = '15px';\n    return skipButton;\n};\nexport const onSkip = (videoAdContainer, callback, { skipoffset, createSkipControl = createDefaultSkipControl } = {}) => {\n    if (!skipoffset) {\n        return () => null;\n    }\n    let skipControl;\n    const { videoElement, element } = videoAdContainer;\n    const skipHandler = () => {\n        const currentTimeMs = videoElement.currentTime * 1000;\n        if (!skipControl &&\n            typeof skipoffset === 'number' &&\n            currentTimeMs >= skipoffset) {\n            skipControl = createSkipControl();\n            skipControl.onclick = (event) => {\n                var _a;\n                (_a = event.stopPropagation) === null || _a === void 0 ? void 0 : _a.call(event);\n                callback(skip);\n                return false;\n            };\n            element.appendChild(skipControl);\n            videoElement.removeEventListener('timeupdate', skipHandler);\n        }\n    };\n    videoElement.addEventListener('timeupdate', skipHandler);\n    return () => {\n        videoElement.removeEventListener('timeupdate', skipHandler);\n        if (skipControl) {\n            element.removeChild(skipControl);\n        }\n    };\n};\n","import { linearEvents, ErrorCode } from '../../../../tracker';\nconst { error } = linearEvents;\nexport const onError = ({ videoElement }, callback) => {\n    const errorHandler = () => {\n        var _a;\n        const mediaError = (_a = videoElement.error) !== null && _a !== void 0 ? _a : undefined;\n        if (mediaError) {\n            Object.defineProperty(mediaError, 'code', {\n                get: () => ErrorCode.VAST_PROBLEM_DISPLAYING_MEDIA_FILE\n            });\n        }\n        callback(error, mediaError);\n    };\n    videoElement.addEventListener('error', errorHandler);\n    return () => {\n        videoElement.removeEventListener('error', errorHandler);\n    };\n};\n","/**\n * Fires when the adUnit's volume has changed.\n *\n * @event VideoAdUnit#volumeChanged\n */\nexport const volumeChanged = 'volumeChanged';\n/**\n * Fires when the adUnit's has finished.\n *\n * @event VideoAdUnit#finish\n */\nexport const finish = 'finish';\n/**\n * fires on ad progress.\n *\n * @event VideoAdUnit#adProgress\n */\nexport const adProgress = 'adProgress';\n","import { linearEvents } from '../../../../tracker';\nimport { adProgress } from '../../../adUnitEvents';\nconst { complete, firstQuartile, midpoint, start, thirdQuartile } = linearEvents;\nconst FIRST_QUARTILE = 25;\nconst MID_POINT = 50;\nconst THIRD_QUARTILE = 75;\nconst COMPLETED = 99;\nconst PERCENTAGE_FACTOR = 100;\nconst percentageProgress = (currentTime, duration) => (currentTime * PERCENTAGE_FACTOR) / duration;\nconst isPassFirstQuartile = (currentTime, duration) => percentageProgress(currentTime, duration) >= FIRST_QUARTILE;\nconst isPassMidPoint = (currentTime, duration) => percentageProgress(currentTime, duration) >= MID_POINT;\nconst isPassThirdQuartile = (currentTime, duration) => percentageProgress(currentTime, duration) >= THIRD_QUARTILE;\nconst isCompleted = (currentTime, duration) => percentageProgress(currentTime, duration) >= COMPLETED;\n// TODO: implement logic to track `timeSpentViewing` linear event\nexport const onTimeUpdate = ({ videoElement }, callback) => {\n    let started = false;\n    let passFirstQuartile = false;\n    let passMidPoint = false;\n    let passThirdQuartile = false;\n    let completed = false;\n    const events = {\n        start: {\n            isFired: (currentTime) => !started && currentTime > 0,\n            callback: () => {\n                started = true;\n                callback(start);\n            }\n        },\n        firstQuartile: {\n            isFired: (currentTime, duration) => !passFirstQuartile && isPassFirstQuartile(currentTime, duration),\n            callback: () => {\n                passFirstQuartile = true;\n                callback(firstQuartile);\n            }\n        },\n        midpoint: {\n            isFired: (currentTime, duration) => !passMidPoint && isPassMidPoint(currentTime, duration),\n            callback: () => {\n                passMidPoint = true;\n                callback(midpoint);\n            }\n        },\n        thirdQuartile: {\n            isFired: (currentTime, duration) => !passThirdQuartile && isPassThirdQuartile(currentTime, duration),\n            callback: () => {\n                passThirdQuartile = true;\n                callback(thirdQuartile);\n            }\n        },\n        complete: {\n            isFired: (currentTime, duration) => !completed && isCompleted(currentTime, duration),\n            callback: () => {\n                completed = true;\n                callback(complete);\n            }\n        }\n    };\n    const timeUpdateHandler = () => {\n        const { duration } = videoElement;\n        const { currentTime } = videoElement;\n        for (const event in events) {\n            if (events[event].isFired(currentTime, duration)) {\n                events[event].callback();\n                break;\n            }\n        }\n        callback(adProgress);\n    };\n    const endedHandler = () => {\n        const { duration } = videoElement;\n        const { currentTime } = videoElement;\n        if (!completed && isCompleted(currentTime, duration)) {\n            completed = true;\n            callback(complete);\n        }\n        videoElement.removeEventListener('ended', endedHandler);\n        videoElement.removeEventListener('timeupdate', timeUpdateHandler);\n    };\n    videoElement.addEventListener('timeupdate', timeUpdateHandler);\n    videoElement.addEventListener('ended', endedHandler);\n    return () => {\n        videoElement.removeEventListener('timeupdate', timeUpdateHandler);\n        videoElement.removeEventListener('ended', endedHandler);\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nimport { volumeChanged } from '../../../adUnitEvents';\nconst { mute, unmute } = linearEvents;\nconst isMuted = (videoElement) => videoElement.muted || videoElement.volume === 0;\nexport const onVolumeChange = ({ videoElement }, callback) => {\n    let wasMuted = isMuted(videoElement);\n    const volumechangeHandler = () => {\n        callback(volumeChanged);\n        if (wasMuted && !isMuted(videoElement)) {\n            callback(unmute);\n        }\n        else if (!wasMuted && isMuted(videoElement)) {\n            callback(mute);\n        }\n        wasMuted = isMuted(videoElement);\n    };\n    videoElement.addEventListener('volumechange', volumechangeHandler);\n    return () => {\n        videoElement.removeEventListener('volumechange', volumechangeHandler);\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nconst { impression, creativeView } = linearEvents;\nexport const onImpression = ({ videoElement }, callback) => {\n    let started = false;\n    const impressionHandler = () => {\n        const { currentTime } = videoElement;\n        if (!started && currentTime > 0) {\n            started = true;\n            callback(impression);\n            callback(creativeView);\n            videoElement.removeEventListener('timeupdate', impressionHandler);\n        }\n    };\n    videoElement.addEventListener('timeupdate', impressionHandler);\n    return () => {\n        videoElement.removeEventListener('timeupdate', impressionHandler);\n    };\n};\n","export const toFixedDigits = (number_, digits) => {\n    let formattedNumber = String(number_);\n    while (formattedNumber.length < digits) {\n        formattedNumber = `0${formattedNumber}`;\n    }\n    return formattedNumber;\n};\n","import { toFixedDigits } from './toFixedDigits';\nconst TIME_NUMBERS = 2;\nconst MS_NUMBERS = 3;\nexport const formatProgress = (progress) => {\n    const hours = Math.floor(progress / (60 * 60 * 1000));\n    const minutes = Math.floor((progress / (60 * 1000)) % 60);\n    const seconds = Math.floor((progress / 1000) % 60);\n    const ms = progress % 1000;\n    return `${toFixedDigits(hours, TIME_NUMBERS)}:${toFixedDigits(minutes, TIME_NUMBERS)}:${toFixedDigits(seconds, TIME_NUMBERS)}.${toFixedDigits(ms, MS_NUMBERS)}`;\n};\n","import { linearEvents } from '../../../../tracker';\nimport { formatProgress } from '../../progress/formatProgress';\nconst { progress } = linearEvents;\nconst secondsToMilliseconds = (seconds) => seconds * 1000;\nconst isPercentage = (offset) => {\n    const percentageRegex = /^\\d+(\\.\\d+)?%$/g;\n    return percentageRegex.test(offset) && !isNaN(parseFloat(offset));\n};\nconst isValid = ({ offset, uri }) => {\n    const offsetIsValid = typeof offset === 'number' || Boolean(offset && isPercentage(offset));\n    const uriIsValid = typeof uri === 'string' && uri.length > 0;\n    return offsetIsValid && uriIsValid;\n};\nconst PERCENTAGE_FACTOR = 100;\nconst offsetToMs = (offset, durationInMs) => {\n    if (typeof offset === 'number') {\n        return offset;\n    }\n    return (parseFloat(offset) / PERCENTAGE_FACTOR) * durationInMs;\n};\nexport const onProgress = ({ videoElement }, callback, { progressEvents = [] } = {}) => {\n    const { duration } = videoElement;\n    const durationInMs = secondsToMilliseconds(duration);\n    let playedMs = 0;\n    let previousCurrentTime = secondsToMilliseconds(videoElement.currentTime);\n    let pendingEvents = progressEvents\n        .filter(isValid)\n        .map(({ offset, uri }) => ({\n        offset: offsetToMs(offset, durationInMs),\n        uri\n    }));\n    const progressHandler = () => {\n        const { currentTime } = videoElement;\n        const delta = Math.abs(currentTime - previousCurrentTime);\n        playedMs += secondsToMilliseconds(delta);\n        previousCurrentTime = currentTime;\n        const { stillPending, toCall } = pendingEvents.reduce((accumulator, event) => {\n            const { offset } = event;\n            if (typeof offset === 'number' && playedMs >= offset) {\n                accumulator.toCall.push(event);\n            }\n            else {\n                accumulator.stillPending.push(event);\n            }\n            return accumulator;\n        }, {\n            stillPending: [],\n            toCall: []\n        });\n        pendingEvents = stillPending;\n        toCall.forEach(({ uri }) => {\n            callback(progress, {\n                contentplayhead: formatProgress(playedMs),\n                progressUri: uri\n            });\n        });\n        if (pendingEvents.length === 0) {\n            videoElement.removeEventListener('timeupdate', progressHandler);\n        }\n    };\n    if (pendingEvents.length > 0) {\n        videoElement.addEventListener('timeupdate', progressHandler);\n    }\n    return () => {\n        videoElement.removeEventListener('timeupdate', progressHandler);\n    };\n};\n","import { linearEvents } from '../../../../tracker';\nconst { clickThrough } = linearEvents;\nconst createDefaultClickControl = () => {\n    const anchor = document.createElement('a');\n    anchor.classList.add('mol-vast-clickthrough');\n    anchor.style.width = '100%';\n    anchor.style.height = '100%';\n    anchor.style.position = 'absolute';\n    anchor.style.left = '0';\n    anchor.style.top = '0';\n    return anchor;\n};\nexport const onClickThrough = ({ videoElement, element }, callback, { clickThroughUrl, pauseOnAdClick = true, createClickControl = createDefaultClickControl } = {}) => {\n    const placeholder = element || videoElement.parentNode;\n    const anchor = createClickControl();\n    const isVirtual = !document.body.contains(anchor);\n    if (isVirtual) {\n        placeholder.appendChild(anchor);\n    }\n    if (clickThroughUrl && anchor instanceof HTMLAnchorElement) {\n        anchor.href = clickThroughUrl;\n        anchor.target = '_blank';\n    }\n    anchor.onclick = (event) => {\n        event.stopPropagation();\n        if (videoElement.paused && pauseOnAdClick) {\n            event.preventDefault();\n            videoElement.play();\n        }\n        else {\n            if (pauseOnAdClick) {\n                videoElement.pause();\n            }\n            callback(clickThrough);\n        }\n    };\n    return () => {\n        if (isVirtual) {\n            placeholder.removeChild(anchor);\n        }\n    };\n};\n","import { onFullscreenChange } from './onFullscreenChange';\nimport { onPlayPause } from './onPlayPause';\nimport { onRewind } from './onRewind';\nimport { onSkip } from './onSkip';\nimport { onError } from './onError';\nimport { onTimeUpdate } from './onTimeUpdate';\nimport { onVolumeChange } from './onVolumeChange';\nimport { onImpression } from './onImpression';\nimport { onProgress } from './onProgress';\nimport { onClickThrough } from './onClickThrough';\nexport const metricHandlers = [\n    onClickThrough,\n    onError,\n    onFullscreenChange,\n    onImpression,\n    onPlayPause,\n    onProgress,\n    onRewind,\n    onSkip,\n    onTimeUpdate,\n    onVolumeChange\n];\n","/**\n * Ad unit error\n */\nexport class AdUnitError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = 'AdUnitError';\n        Object.setPrototypeOf(this, AdUnitError.prototype);\n    }\n}\n","export const MutationObserver = window.MutationObserver ||\n    window.WebKitMutationObserver ||\n    window.MozMutationObserver;\n","import debounce from 'lodash.debounce';\nimport { MutationObserver } from './helpers/MutationObserver';\nconst validate = (target, callback) => {\n    if (!(target instanceof Element)) {\n        throw new TypeError('Target is not an Element node');\n    }\n    if (!(callback instanceof Function)) {\n        throw new TypeError('Callback is not a function');\n    }\n};\nconst noop = () => { };\nconst sizeMutationAttributes = ['style', 'clientWidth', 'clientHeight'];\nconst createResizeMO = (target, callback) => {\n    const observer = new MutationObserver((mutations) => {\n        for (let index = 0; index < mutations.length; index++) {\n            const { attributeName } = mutations[index];\n            if (attributeName && sizeMutationAttributes.includes(attributeName)) {\n                callback();\n            }\n        }\n    });\n    observer.observe(target, {\n        attributes: true,\n        characterData: false,\n        childList: true\n    });\n    return observer;\n};\nconst mutationHandlers = Symbol('mutationHandlers');\nconst observerKey = Symbol('mutationObserver');\nconst onMutation = (target, callback) => {\n    var _a;\n    if (!target[mutationHandlers]) {\n        target[mutationHandlers] = [];\n        const execHandlers = () => {\n            var _a;\n            (_a = target[mutationHandlers]) === null || _a === void 0 ? void 0 : _a.forEach((handler) => handler());\n        };\n        target[observerKey] = createResizeMO(target, execHandlers);\n    }\n    (_a = target[mutationHandlers]) === null || _a === void 0 ? void 0 : _a.push(callback);\n    return () => {\n        var _a, _b, _c;\n        target[mutationHandlers] = (_a = target[mutationHandlers]) === null || _a === void 0 ? void 0 : _a.filter((handler) => handler !== callback);\n        if (((_b = target[mutationHandlers]) === null || _b === void 0 ? void 0 : _b.length) === 0) {\n            (_c = target[observerKey]) === null || _c === void 0 ? void 0 : _c.disconnect();\n            delete target[mutationHandlers];\n            delete target[observerKey];\n        }\n    };\n};\nconst createResizeElement = (callback) => {\n    const iframe = document.createElement('iframe');\n    iframe.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; border: 0; overflow: hidden; pointer-events: none; z-index: -1;');\n    iframe.setAttribute('type', 'text/html');\n    iframe.setAttribute('loading', 'eager');\n    iframe.onload = () => {\n        if (iframe.contentWindow) {\n            iframe.contentWindow.addEventListener('resize', callback);\n        }\n    };\n    iframe.src = 'about:blank';\n    return iframe;\n};\nconst resizeHandlers = Symbol('resizeHandlers');\nconst resizeElement = Symbol('resizeElement');\n// Original code http://www.backalleycoder.com/2013/03/18/cross-browser-event-based-element-resize-detection/\nconst onResize = (target, callback) => {\n    var _a;\n    if (!target[resizeHandlers]) {\n        target[resizeHandlers] = [];\n        const execHandlers = () => {\n            var _a;\n            (_a = target[resizeHandlers]) === null || _a === void 0 ? void 0 : _a.forEach((handler) => handler());\n        };\n        target[resizeElement] = createResizeElement(execHandlers);\n        if (getComputedStyle(target).position === 'static') {\n            target.style.position = 'relative';\n        }\n        target.appendChild(target[resizeElement]);\n    }\n    (_a = target[resizeHandlers]) === null || _a === void 0 ? void 0 : _a.push(callback);\n    return () => {\n        var _a, _b;\n        target[resizeHandlers] = (_a = target[resizeHandlers]) === null || _a === void 0 ? void 0 : _a.filter((handler) => handler !== callback);\n        if (((_b = target[resizeHandlers]) === null || _b === void 0 ? void 0 : _b.length) === 0) {\n            target.removeChild(target[resizeElement]);\n            delete target[resizeHandlers];\n            delete target[resizeElement];\n        }\n    };\n};\n/**\n * Helper function to know if an element has been resized.\n *\n * @ignore\n *\n * @param target The element that we want to observe.\n * @param callback The callback that handles the resize.\n * @param options Options Map.\n *\n * @returns Unsubscribe function.\n */\nexport const onElementResize = (target, callback, { threshold = 20 } = {}) => {\n    validate(target, callback);\n    const makeSizeId = ({ style, clientHeight, clientWidth }) => [style.width, style.height, clientWidth, clientHeight].join('.');\n    let lastSize = makeSizeId(target);\n    const checkElementSize = () => {\n        const currentSize = makeSizeId(target);\n        if (currentSize !== lastSize) {\n            lastSize = currentSize;\n            callback();\n        }\n    };\n    const checkElementHandler = debounce(checkElementSize, threshold);\n    const stopObservingMutations = MutationObserver\n        ? onMutation(target, checkElementHandler)\n        : noop;\n    const stopListeningToResize = onResize(target, checkElementHandler);\n    return () => {\n        stopObservingMutations();\n        stopListeningToResize();\n    };\n};\n","export const { IntersectionObserver } = window;\n","import debounce from 'lodash.debounce';\nimport { IntersectionObserver } from './helpers/IntersectionObserver';\nconst validate = (target, callback) => {\n    if (!(target instanceof Element)) {\n        throw new TypeError('Target is not an Element node');\n    }\n    if (!(callback instanceof Function)) {\n        throw new TypeError('Callback is not a function');\n    }\n};\nconst noop = () => { };\nconst intersectionHandlers = Symbol('intersectionHandlers');\nconst observerKey = Symbol('intersectionObserver');\nconst THRESHOLDS_COUNT = 11;\nconst onIntersection = (target, callback) => {\n    var _a, _b;\n    if (!target[intersectionHandlers]) {\n        target[intersectionHandlers] = [];\n        const execHandlers = (entries, observer) => {\n            var _a;\n            (_a = target[intersectionHandlers]) === null || _a === void 0 ? void 0 : _a.forEach((handler) => handler(entries, observer));\n        };\n        const options = {\n            root: null,\n            rootMargin: '0px',\n            threshold: [...new Array(THRESHOLDS_COUNT)].map((_item, index) => index / (THRESHOLDS_COUNT - 1))\n        };\n        target[observerKey] = new IntersectionObserver(execHandlers, options);\n        (_a = target[observerKey]) === null || _a === void 0 ? void 0 : _a.observe(target);\n    }\n    (_b = target[intersectionHandlers]) === null || _b === void 0 ? void 0 : _b.push(callback);\n    return () => {\n        var _a, _b, _c;\n        target[intersectionHandlers] = (_a = target[intersectionHandlers]) === null || _a === void 0 ? void 0 : _a.filter((handler) => handler !== callback);\n        if (((_b = target[intersectionHandlers]) === null || _b === void 0 ? void 0 : _b.length) === 0) {\n            (_c = target[observerKey]) === null || _c === void 0 ? void 0 : _c.disconnect();\n            delete target[intersectionHandlers];\n            delete target[observerKey];\n        }\n    };\n};\nlet visibilityHandlers = [];\nconst onVisibilityChange = (_target, callback) => {\n    const execHandlers = () => {\n        if (visibilityHandlers) {\n            visibilityHandlers.forEach((handler) => handler());\n        }\n    };\n    visibilityHandlers.push(callback);\n    if (visibilityHandlers.length === 1) {\n        document.addEventListener('visibilitychange', execHandlers);\n    }\n    return () => {\n        visibilityHandlers = visibilityHandlers.filter((handler) => handler !== callback);\n        if (visibilityHandlers.length === 0) {\n            document.removeEventListener('visibilitychange', execHandlers);\n        }\n    };\n};\nlet lastIntersectionEntries = [];\n/**\n * Helper function to know if the visibility of an element has changed.\n *\n * @ignore\n *\n * @param target The element that we want to observe.\n * @param callback The callback that handles the visibility change.\n * @param options Options Map.\n *\n * @returns Unsubscribe function.\n */\nexport const onElementVisibilityChange = (target, callback, { threshold = 100, viewabilityOffset = 0.4 } = {}) => {\n    validate(target, callback);\n    if (!IntersectionObserver) {\n        // NOTE: visibility is not determined\n        callback(undefined);\n        return noop;\n    }\n    let lastIsInViewport = false;\n    const checkVisibility = (entries) => {\n        entries.forEach((entry) => {\n            if (entry.target === target) {\n                const isInViewport = !document.hidden && entry.intersectionRatio > viewabilityOffset;\n                if (isInViewport !== lastIsInViewport) {\n                    lastIsInViewport = isInViewport;\n                    callback(isInViewport);\n                }\n            }\n        });\n        lastIntersectionEntries = entries;\n    };\n    const visibilityHandler = debounce(checkVisibility, threshold);\n    const stopObservingIntersection = onIntersection(target, visibilityHandler);\n    const stopListeningToVisibilityChange = onVisibilityChange(target, () => visibilityHandler(lastIntersectionEntries));\n    return () => {\n        stopObservingIntersection();\n        stopListeningToVisibilityChange();\n    };\n};\n","/**\n * Subset of node's [Emitter class](https://nodejs.org/api/events.html#events_class_eventemitter)\n *\n * @param logger Optional logger instance. Must comply to the [Console interface](https://developer.mozilla.org/es/docs/Web/API/Console).\n */\nexport class Emitter {\n    constructor(logger) {\n        this.events = {};\n        this.logger = logger || console;\n    }\n    /**\n     * Adds the listener function to the end of the listeners array for the event named eventName.\n     *\n     * @param eventName The name of the event.\n     * @param listener Listener fn that handles the evt.\n     * @returns The Emitter instance.\n     */\n    on(eventName, listener) {\n        const { events } = this;\n        const eventListeners = events[eventName] || (events[eventName] = []);\n        eventListeners.push(listener);\n        return this;\n    }\n    /**\n     * Removes the specified listener from the listener array for the event named eventName.\n     *\n     * @param eventName The name of the event.\n     * @param listener Listener fn that handles the evt.\n     * @returns The Emitter instance.\n     */\n    removeListener(eventName, listener) {\n        const { events } = this;\n        const eventListeners = events[eventName] || (events[eventName] = []);\n        events[eventName] = eventListeners.filter((existedListener) => existedListener !== listener && existedListener._ !== listener);\n        return this;\n    }\n    /**\n     * Removes all listeners, or those of the specified eventName.\n     *\n     * @param eventName The name of the event. Optional if omitted all listeners will be removed.\n     * @returns The Emitter instance.\n     */\n    removeAllListeners(eventName) {\n        if (eventName) {\n            delete this.events[eventName];\n        }\n        else {\n            this.events = {};\n        }\n        return this;\n    }\n    /**\n     * Adds a one time listener function for the event named eventName. The next time eventName is triggered,\n     * this listener is removed and then invoked.\n     *\n     * @param eventName The name of the event.\n     * @param listener Listener fn that handles the evt.\n     * @returns The Emitter instance.\n     */\n    once(eventName, listener) {\n        const handler = (...args) => {\n            this.removeListener(eventName, handler);\n            listener(...args);\n        };\n        handler._ = listener;\n        return this.on(eventName, handler);\n    }\n    /**\n     * Synchronously calls each of the listeners registered for the event named eventName, in the order they were registered,\n     * passing the supplied arguments to each.\n     *\n     * @param eventName The name of the event.\n     * @returns Returns true if the event had listeners, false otherwise.\n     */\n    emit(eventName, ...args) {\n        const { events } = this;\n        const eventListeners = events[eventName] || (events[eventName] = []);\n        const hasListeners = eventListeners.length > 0;\n        eventListeners.forEach((handler) => {\n            try {\n                handler(...args);\n            }\n            catch (error) {\n                if (error instanceof Error) {\n                    this.logger.error(error, error.stack);\n                }\n            }\n        });\n        return hasListeners;\n    }\n}\n","export const getResource = ({ staticResource, htmlResource, iFrameResource: indexFrameResource } = {}) => staticResource || htmlResource || indexFrameResource || undefined;\n","import { getIcons } from '../../../vastSelectors';\nimport { getResource } from '../resources/getResource';\nconst UNKNOWN = 'UNKNOWN';\nconst uniqBy = (array, uniqValue) => {\n    const seen = {};\n    return array.filter((item) => {\n        const key = uniqValue(item);\n        if (!key || seen.hasOwnProperty(key)) {\n            return false;\n        }\n        seen[key] = true;\n        return true;\n    });\n};\nconst uniqByResource = (icons) => uniqBy(icons, getResource);\nconst groupIconsByProgram = (icons) => icons.reduce((accumulator, icon) => {\n    var _a, _b;\n    const program = (_a = icon.program) !== null && _a !== void 0 ? _a : UNKNOWN;\n    (_b = accumulator[program]) !== null && _b !== void 0 ? _b : (accumulator[program] = []);\n    accumulator[program].push(icon);\n    return accumulator;\n}, {});\nconst sortIconByBestPxratio = (icons) => {\n    const devicePixelRatio = window.devicePixelRatio || 0;\n    const compareTo = (iconA, iconB) => {\n        const deltaA = Math.abs(devicePixelRatio - (iconA.pxratio || 0));\n        const deltaB = Math.abs(devicePixelRatio - (iconB.pxratio || 0));\n        return deltaA - deltaB;\n    };\n    return icons.slice(0).sort(compareTo);\n};\nconst chooseByPxRatio = (icons) => {\n    if (icons.length === 1) {\n        return icons[0];\n    }\n    return sortIconByBestPxratio(icons)[0];\n};\nconst chooseIcons = (icons) => {\n    const byProgram = groupIconsByProgram(icons);\n    const programs = Object.keys(byProgram);\n    return programs.reduce((accumulator, program) => {\n        if (program === UNKNOWN) {\n            return [...accumulator, ...byProgram[UNKNOWN]];\n        }\n        return [...accumulator, chooseByPxRatio(byProgram[program])];\n    }, []);\n};\nexport const retrieveIcons = (vastChain) => {\n    const ads = vastChain.map(({ ad }) => ad).filter(Boolean);\n    const icons = ads.reduce((accumulator, ad) => [...accumulator, ...(getIcons(ad) || [])], []);\n    if (icons.length > 0) {\n        const uniqIcons = uniqByResource(icons);\n        return chooseIcons(uniqIcons);\n    }\n};\n","import { once } from './once';\nexport const waitFor = (element, event) => {\n    let pending = true;\n    let resolvePromise;\n    let rejectPromise;\n    const promise = new Promise((resolve, reject) => {\n        resolvePromise = resolve;\n        rejectPromise = reject;\n    });\n    const cancelOnce = once(element, event, (...args) => {\n        pending = false;\n        resolvePromise(args);\n    });\n    const cancel = () => {\n        if (pending) {\n            pending = false;\n            cancelOnce();\n            rejectPromise(new Error('waitFor was canceled'));\n        }\n    };\n    return {\n        cancel,\n        promise\n    };\n};\n","class FetchError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = 'FetchError';\n        Object.setPrototypeOf(this, FetchError.prototype);\n    }\n}\nconst isValidContentType = (contentType) => {\n    const normalisedCT = contentType.toLowerCase();\n    return ['text/plain', 'text/html'].some((allowedType) => normalisedCT.includes(allowedType));\n};\nconst BAD_REQUEST = 400;\nexport const fetchHtml = async (endpoint) => {\n    const response = await fetch(endpoint);\n    const contentType = response.headers.get('Content-Type');\n    if (response.status >= BAD_REQUEST) {\n        const error = new FetchError(response.statusText);\n        error.response = response;\n        throw error;\n    }\n    if (!contentType || !isValidContentType(contentType)) {\n        const error = new FetchError(`fetchHtml error, invalid Content-Type ${contentType}`);\n        error.response = response;\n        throw error;\n    }\n    return response.text();\n};\n","import { createHtmlResource } from './createHtmlResource';\nimport { createIframeResource } from './createIframeResource';\nimport { createStaticResource } from './createStaticResource';\nconst noopResource = document.createElement('div');\nexport const createResource = (document, data) => {\n    const { staticResource, htmlResource, iFrameResource: indexFrameResource } = data;\n    if (staticResource) {\n        return createStaticResource(staticResource, {\n            data,\n            document\n        });\n    }\n    if (htmlResource) {\n        return createHtmlResource(htmlResource, {\n            data,\n            document\n        });\n    }\n    if (indexFrameResource) {\n        return createIframeResource(indexFrameResource, {\n            data,\n            document\n        });\n    }\n    return noopResource;\n};\n","import { waitFor } from '../dom/waitFor';\nimport { createResource } from './createResource';\nconst noop = () => { };\nexport const loadResource = (icon, { document, placeholder }) => new Promise((resolve, reject) => {\n    try {\n        const resourceElement = createResource(document, icon);\n        const resourceErrorWait = waitFor(resourceElement, 'error');\n        const resourceLoadWait = waitFor(resourceElement, 'load');\n        const cleanUp = () => {\n            if (placeholder.contains(resourceElement)) {\n                placeholder.removeChild(resourceElement);\n                resourceElement.style.zIndex = '0';\n            }\n        };\n        /* eslint-disable promise/prefer-await-to-then */\n        resourceErrorWait.promise\n            .then(() => {\n            resourceLoadWait.cancel();\n            cleanUp();\n            reject(new Error('Error loading resource'));\n        })\n            .catch(noop);\n        resourceLoadWait.promise\n            .then(() => {\n            resourceErrorWait.cancel();\n            cleanUp();\n            resolve(resourceElement);\n        })\n            .catch(noop);\n        /* eslint-enable promise/prefer-await-to-then */\n        // Some browsers will not load the resource if they are not added to the DOM\n        resourceElement.style.zIndex = '-9999';\n        placeholder.appendChild(resourceElement);\n    }\n    catch (error) {\n        reject(error);\n    }\n});\n","export const createStaticResource = (source, { document, data }) => {\n    const { height, width } = data;\n    const image = document.createElement('img');\n    if (width) {\n        image.width = width;\n    }\n    if (height) {\n        image.height = height;\n    }\n    image.src = source;\n    return image;\n};\n","import { fetchHtml } from '../fetch/fetchHtml';\nexport const createHtmlResource = (source, { document, data }) => {\n    const { height, width } = data;\n    const divElement = document.createElement('div');\n    if (width) {\n        divElement.style.width = `${width}px`;\n    }\n    if (height) {\n        divElement.style.height = `${height}px`;\n    }\n    /* eslint-disable promise/prefer-await-to-then */\n    fetchHtml(source)\n        .then((html) => {\n        divElement.innerHTML = html;\n        divElement.dispatchEvent(new CustomEvent('load'));\n    })\n        .catch(() => {\n        divElement.dispatchEvent(new CustomEvent('error'));\n    });\n    /* eslint-enable promise/prefer-await-to-then */\n    return divElement;\n};\n","export const createIframeResource = (source, { document, data }) => {\n    const { height, width } = data;\n    const iframeElement = document.createElement('iframe');\n    iframeElement.setAttribute('sandbox', 'allow-forms allow-popups allow-scripts');\n    iframeElement.setAttribute('loading', 'eager');\n    if (width) {\n        iframeElement.width = width.toString();\n    }\n    if (height) {\n        iframeElement.height = height.toString();\n    }\n    iframeElement.src = source;\n    iframeElement.frameBorder = '0';\n    iframeElement.style.border = 'none';\n    return iframeElement;\n};\n","const calculateArea = ({ height, width }) => height * width;\nconst ICON_MIN_SIZE = 0.35;\nexport const hasSpace = (newIcon, config) => {\n    const { drawnIcons, placeholder } = config;\n    const placeholderArea = calculateArea(placeholder.getBoundingClientRect());\n    const iconArea = calculateArea(newIcon);\n    const usedIconsArea = drawnIcons.reduce((accumulator, icon) => {\n        const { width, height } = icon;\n        if (!width || !height) {\n            return accumulator;\n        }\n        return accumulator + calculateArea({ width, height });\n    }, 0);\n    return iconArea + usedIconsArea <= placeholderArea * ICON_MIN_SIZE;\n};\nexport const withinBoundaries = (newIcon, { placeholder }) => {\n    const phRect = placeholder.getBoundingClientRect();\n    return (newIcon.left >= 0 &&\n        newIcon.left + newIcon.width <= phRect.width &&\n        newIcon.top >= 0 &&\n        newIcon.top + newIcon.height <= phRect.height);\n};\nconst right = ({ left, width }) => left + width;\nconst left = ({ left }) => left;\nconst top = ({ top }) => top;\nconst bottom = ({ top, height }) => top + height;\nconst overlap = (newIcon, drawnIcon) => left(newIcon) <= right(drawnIcon) &&\n    right(newIcon) >= left(drawnIcon) &&\n    bottom(newIcon) >= top(drawnIcon) &&\n    top(newIcon) <= bottom(drawnIcon);\nexport const withoutOverlaps = (newIcon, { drawnIcons }) => !drawnIcons.some((drawnIcon) => overlap(newIcon, drawnIcon));\nexport const canBeRendered = (newIcon, config) => {\n    const thereIsSpace = hasSpace(newIcon, config);\n    const isWithinTheContentArea = withinBoundaries(newIcon, config);\n    const doesNotOverlap = withoutOverlaps(newIcon, config);\n    return thereIsSpace && isWithinTheContentArea && doesNotOverlap;\n};\n","import { loadResource } from '../resources/loadResource';\nimport { updateIcon } from './updateIcon';\nimport { canBeRendered } from './canBeRendered';\nconst noop = () => { };\nconst wrapWithClickThrough = (iconElement, icon, { onIconClick = noop } = {}) => {\n    const anchor = document.createElement('a');\n    if (icon.iconClickThrough) {\n        anchor.href = icon.iconClickThrough;\n        anchor.target = '_blank';\n    }\n    // NOTE: if iframe icon disable pointer events so that clickThrough and click tracking work\n    if (icon.iFrameResource) {\n        iconElement.style.pointerEvents = 'none';\n    }\n    anchor.onclick = (event) => {\n        if (Event.prototype.stopPropagation !== undefined) {\n            event.stopPropagation();\n        }\n        onIconClick(icon);\n    };\n    anchor.appendChild(iconElement);\n    return anchor;\n};\nconst createIcon = async (icon, options) => {\n    if (!icon.element) {\n        const iconResource = await loadResource(icon, options);\n        if (iconResource instanceof HTMLIFrameElement ||\n            iconResource instanceof HTMLImageElement) {\n            iconResource.width = '100%';\n            iconResource.height = '100%';\n        }\n        iconResource.style.height = '100%';\n        iconResource.style.width = '100%';\n        icon.element = wrapWithClickThrough(iconResource, icon, options);\n    }\n    return icon.element;\n};\nconst updateIconElement = (iconElement, icon) => {\n    const { height, width, left, top, yPosition } = icon;\n    iconElement.style.position = 'absolute';\n    iconElement.style.left = `${left}px`;\n    // NOTE: This if is a bit odd but some browser don't calculate the placeholder height pixel perfect and,\n    //       setting the top of the icon will change the size of the icon's placeholder this if prevents that situation\n    if (yPosition === 'bottom') {\n        iconElement.style.bottom = '0';\n    }\n    else {\n        iconElement.style.top = `${top}px`;\n    }\n    iconElement.style.height = `${height}px`;\n    iconElement.style.width = `${width}px`;\n    return iconElement;\n};\nexport const renderIcon = async (icon, config) => {\n    var _a;\n    const { placeholder } = config;\n    const iconElement = await createIcon(icon, config);\n    const updatedIcon = updateIcon(icon, iconElement, config);\n    if (canBeRendered(updatedIcon, config)) {\n        if (!iconElement.parentNode || updatedIcon.updated) {\n            placeholder.appendChild(updateIconElement(iconElement, updatedIcon));\n        }\n    }\n    else {\n        (_a = iconElement.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(iconElement);\n        throw new Error(\"Icon can't be rendered\");\n    }\n    return updatedIcon;\n};\n","import { renderIcon } from './renderIcon';\nimport { canBeShown } from './canBeShown';\nexport const renderIcons = async (icons, { onIconClick, videoAdContainer, logger = console }) => {\n    const { element, videoElement } = videoAdContainer;\n    const drawnIcons = [];\n    const { iconsToShow, otherIcons } = icons.reduce((accumulator, icon) => {\n        if (canBeShown(icon, videoElement)) {\n            accumulator.iconsToShow.push(icon);\n        }\n        else {\n            accumulator.otherIcons.push(icon);\n        }\n        return accumulator;\n    }, {\n        iconsToShow: [],\n        otherIcons: []\n    });\n    otherIcons.forEach(({ element: iconElement }) => {\n        var _a;\n        (_a = iconElement === null || iconElement === void 0 ? void 0 : iconElement.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(iconElement);\n    });\n    await iconsToShow.reduce(async (promise, icon) => {\n        try {\n            await promise;\n            const renderedIcon = await renderIcon(icon, {\n                document,\n                drawnIcons,\n                onIconClick,\n                placeholder: element\n            });\n            drawnIcons.push(renderedIcon);\n        }\n        catch (error) {\n            logger.log(error);\n        }\n    }, Promise.resolve());\n    return drawnIcons;\n};\n","export const canBeShown = (icon, videoElement) => {\n    const currentTimeInMs = videoElement.currentTime * 1000;\n    const videoDurationInMs = videoElement.duration * 1000;\n    const offset = typeof icon.offset === 'string'\n        ? parseInt(icon.offset, 10)\n        : icon.offset || 0;\n    const duration = icon.duration || videoDurationInMs;\n    return offset <= currentTimeInMs && currentTimeInMs - offset <= duration;\n};\n","const isCustomXposition = (xPosition) => !['left', 'right'].includes(String(xPosition).toLowerCase());\nconst isCustomYPosition = (yPosition) => !['top', 'bottom'].includes(String(yPosition).toLowerCase());\nconst calculateIconLeft = (dynamicPos, iconWidth, drawnIcons, phWidth\n// eslint-disable-next-line max-params\n) => {\n    const drawnIconsWidth = drawnIcons.reduce((accumulator, icon) => accumulator + (icon.width ? icon.width + 1 : 0), 0);\n    if (dynamicPos === 'left') {\n        return drawnIconsWidth;\n    }\n    return phWidth - drawnIconsWidth - iconWidth;\n};\nconst calculateIconTop = (dynamicPos, iconHeight, phHeight) => {\n    if (dynamicPos === 'top') {\n        return 0;\n    }\n    return phHeight - iconHeight;\n};\nexport const updateIcon = (icon, iconElement, { drawnIcons, placeholder }) => {\n    const { signature: oldSignature } = icon;\n    const rect = iconElement.getBoundingClientRect();\n    const phRect = placeholder.getBoundingClientRect();\n    const width = icon.width || rect.width;\n    const height = icon.height || rect.height;\n    const xPosition = icon.xPosition || 'right';\n    const yPosition = icon.yPosition || 'top';\n    let left;\n    let top;\n    if (isCustomXposition(xPosition)) {\n        left = xPosition;\n    }\n    else {\n        const icons = drawnIcons.filter((dIcon) => dIcon.xPosition === xPosition && dIcon.yPosition === yPosition);\n        left = calculateIconLeft(xPosition, width, icons, phRect.width);\n    }\n    if (isCustomYPosition(yPosition)) {\n        top = yPosition;\n    }\n    else {\n        top = calculateIconTop(yPosition, height, phRect.height);\n    }\n    const signature = `${left}-${top}_${width}x${height}`;\n    return Object.assign(icon, {\n        height,\n        left,\n        signature,\n        top,\n        updated: oldSignature !== signature,\n        width\n    });\n};\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { renderIcons } from './renderIcons';\nconst firstRenderPending = Symbol('firstRenderPending');\nconst noop = () => { };\nconst hasPendingIconRedraws = (icons, videoElement) => {\n    const currentTimeInMs = videoElement.currentTime * 1000;\n    const videoDurationInMs = videoElement.duration * 1000;\n    const iconsPendingToRedraw = icons.filter((icon) => !icon.offset || icon.offset < currentTimeInMs);\n    const iconsPendingToBeRemoved = icons.filter((icon) => icon.duration && icon.duration < videoDurationInMs);\n    return iconsPendingToRedraw.length > 0 || iconsPendingToBeRemoved.length > 0;\n};\nconst removeDrawnIcons = (icons) => icons\n    .filter(({ element }) => Boolean(element === null || element === void 0 ? void 0 : element.parentNode))\n    .forEach(({ element }) => { var _a; return (_a = element === null || element === void 0 ? void 0 : element.parentNode) === null || _a === void 0 ? void 0 : _a.removeChild(element); });\nexport const addIcons = (icons, _a) => {\n    var { videoAdContainer, onIconView = noop, onIconClick = noop } = _a, rest = __rest(_a, [\"videoAdContainer\", \"onIconView\", \"onIconClick\"]);\n    const { videoElement, element } = videoAdContainer;\n    const drawIcons = async () => {\n        const drawnIcons = await renderIcons(icons, Object.assign({ onIconClick,\n            videoAdContainer }, rest));\n        element.dispatchEvent(new CustomEvent('iconsDrawn'));\n        drawnIcons.forEach((icon) => {\n            if (icon[firstRenderPending]) {\n                onIconView(icon);\n                icon[firstRenderPending] = false;\n            }\n        });\n    };\n    icons.forEach((icon) => {\n        icon[firstRenderPending] = true;\n    });\n    return {\n        drawIcons,\n        hasPendingIconRedraws: () => hasPendingIconRedraws(icons, videoElement),\n        removeIcons: () => removeDrawnIcons(icons)\n    };\n};\n","const FULLSCREEN_LAPSE = 100;\nconst THUMBNAIL_MAX_WIDTH = 400;\nexport const viewmode = (width, height) => {\n    const { screen } = window;\n    const isFullscreen = width + FULLSCREEN_LAPSE > screen.width &&\n        height + FULLSCREEN_LAPSE > screen.height;\n    if (isFullscreen) {\n        return 'fullscreen';\n    }\n    if (width < THUMBNAIL_MAX_WIDTH) {\n        return 'thumbnail';\n    }\n    return 'normal';\n};\n","var _a, _b;\nimport { linearEvents } from '../tracker';\nimport { getViewable } from '../vastSelectors';\nimport { finish } from './adUnitEvents';\nimport { onElementVisibilityChange, onElementResize } from './helpers/dom/elementObservers';\nimport { preventManualProgress } from './helpers/dom/preventManualProgress';\nimport { Emitter } from './helpers/Emitter';\nimport { retrieveIcons } from './helpers/icons/retrieveIcons';\nimport { addIcons } from './helpers/icons/addIcons';\nimport { viewmode } from './helpers/vpaid/viewmode';\nimport { safeCallback } from './helpers/safeCallback';\nconst { start, viewable, notViewable, viewUndetermined, iconClick, iconView } = linearEvents;\nconst VIEWABLE_IMPRESSION_TIMEOUT = 2000;\nconst _private = Symbol('_private');\nexport const _protected = Symbol('_protected');\n/**\n * This class provides shared logic among all the ad units.\n */\nexport class VideoAdUnit extends Emitter {\n    /**\n     * Creates a {@link VideoAdUnit}.\n     *\n     * @param vastChain The {@link VastChain} with all the {@link VastResponse}\n     * @param videoAdContainer container instance to place the ad\n     * @param options Options Map. The allowed properties are:\n     */\n    constructor(vastChain, videoAdContainer, { viewability = false, responsive = false, logger = console, pauseOnAdClick = true } = {}) {\n        super(logger);\n        this[_a] = {\n            addIcons: () => {\n                if (!this.icons) {\n                    return;\n                }\n                const { drawIcons, hasPendingIconRedraws, removeIcons } = addIcons(this.icons, {\n                    logger: this.logger,\n                    onIconClick: (icon) => this.emit(iconClick, {\n                        adUnit: this,\n                        data: icon,\n                        type: iconClick\n                    }),\n                    onIconView: (icon) => this.emit(iconView, {\n                        adUnit: this,\n                        data: icon,\n                        type: iconView\n                    }),\n                    videoAdContainer: this.videoAdContainer\n                });\n                this[_protected].drawIcons = drawIcons;\n                this[_protected].removeIcons = removeIcons;\n                this[_protected].hasPendingIconRedraws = hasPendingIconRedraws;\n                this[_protected].onFinishCallbacks.push(removeIcons);\n            },\n            setupViewableImpression: () => {\n                let timeoutId;\n                const unsubscribe = onElementVisibilityChange(this.videoAdContainer.element, (visible) => {\n                    if (this.isFinished() || this[_protected].viewable) {\n                        return;\n                    }\n                    if (typeof visible !== 'boolean') {\n                        this[_private].handleViewableImpression(viewUndetermined);\n                        return;\n                    }\n                    if (visible) {\n                        timeoutId = window.setTimeout(this[_private].handleViewableImpression, VIEWABLE_IMPRESSION_TIMEOUT, viewable);\n                    }\n                    else {\n                        clearTimeout(timeoutId);\n                    }\n                }, { viewabilityOffset: 0.5 });\n                this[_protected].onFinishCallbacks.push(() => {\n                    unsubscribe();\n                    clearTimeout(timeoutId);\n                    if (!this[_protected].viewable) {\n                        this[_private].handleViewableImpression(notViewable);\n                    }\n                });\n            },\n            handleViewableImpression: (event) => {\n                this[_protected].viewable = Boolean(event);\n                this.emit(event, {\n                    adUnit: this,\n                    type: event\n                });\n            },\n            setupViewability: () => {\n                const unsubscribe = onElementVisibilityChange(this.videoAdContainer.element, (visible) => {\n                    if (this.isFinished()) {\n                        return;\n                    }\n                    if (typeof visible === 'boolean') {\n                        if (visible) {\n                            this.resume();\n                        }\n                        else {\n                            this.pause();\n                        }\n                    }\n                });\n                this[_protected].onFinishCallbacks.push(unsubscribe);\n            },\n            setupResponsive: () => {\n                const { element } = this.videoAdContainer;\n                this[_protected].size = {\n                    height: element.clientHeight,\n                    viewmode: viewmode(element.clientWidth, element.clientHeight),\n                    width: element.clientWidth\n                };\n                const unsubscribe = onElementResize(element, () => {\n                    if (this.isFinished()) {\n                        return;\n                    }\n                    const previousSize = this[_protected].size;\n                    const height = element.clientHeight;\n                    const width = element.clientWidth;\n                    if (height !== (previousSize === null || previousSize === void 0 ? void 0 : previousSize.height) || width !== (previousSize === null || previousSize === void 0 ? void 0 : previousSize.width)) {\n                        this.resize(width, height, viewmode(width, height));\n                    }\n                });\n                this[_protected].onFinishCallbacks.push(unsubscribe);\n            }\n        };\n        this[_b] = {\n            finished: false,\n            started: false,\n            viewable: false,\n            onErrorCallbacks: [],\n            onFinishCallbacks: [],\n            finish: () => {\n                if (!this.isFinished()) {\n                    this[_protected].finished = true;\n                    this[_protected].onFinishCallbacks.forEach((callback) => callback());\n                    this.emit(finish, {\n                        adUnit: this,\n                        type: finish\n                    });\n                }\n            },\n            throwIfCalled: () => {\n                throw new Error('VideoAdUnit method must be implemented on child class');\n            },\n            throwIfFinished: () => {\n                if (this.isFinished()) {\n                    throw new Error('VideoAdUnit is finished');\n                }\n            }\n        };\n        /** Reference to the {@link VastChain} used to load the ad. */\n        this.vastChain = vastChain;\n        /** Reference to the {@link VideoAdContainer} that contains the ad. */\n        this.videoAdContainer = videoAdContainer;\n        /** Array of {@link VastIcon} definitions to display from the passed {@link VastChain} or undefined if there are no icons.*/\n        this.icons = retrieveIcons(vastChain);\n        this.pauseOnAdClick = pauseOnAdClick;\n        this[_protected].onFinishCallbacks.push(preventManualProgress(this.videoAdContainer.videoElement));\n        this[_private].addIcons();\n        const viewableImpression = vastChain.some(({ ad }) => ad && getViewable(ad));\n        if (viewableImpression) {\n            this.once(start, this[_private].setupViewableImpression);\n        }\n        if (viewability) {\n            this.once(start, this[_private].setupViewability);\n        }\n        if (responsive) {\n            this.once(start, this[_private].setupResponsive);\n        }\n    }\n    /*\n     * Starts the ad unit.\n     *\n     * @throws if called twice.\n     * @throws if ad unit is finished.\n     */\n    start() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Resumes a previously paused ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    resume() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Pauses the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    pause() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Skips the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    skip() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Sets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @param volume must be a value between 0 and 1;\n     */\n    setVolume(_volume) {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Gets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @returns the volume of the ad unit.\n     */\n    getVolume() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Cancels the ad unit.\n     *\n     * @throws if ad unit is finished.\n     */\n    cancel() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Returns the duration of the ad Creative or 0 if there is no creative.\n     *\n     * @returns the duration of the ad unit.\n     */\n    duration() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Returns true if the ad is paused and false otherwise\n     */\n    paused() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Returns the current time of the ad Creative or 0 if there is no creative.\n     *\n     * @returns the current time of the ad unit.\n     */\n    currentTime() {\n        this[_protected].throwIfCalled();\n    }\n    /**\n     * Register a callback function that will be called whenever the ad finishes. No matter if it was finished because de ad ended, or cancelled or there was an error playing the ad.\n     *\n     * @throws if ad unit is finished.\n     *\n     * @param callback will be called once the ad unit finished\n     */\n    onFinish(callback) {\n        if (typeof callback !== 'function') {\n            throw new TypeError('Expected a callback function');\n        }\n        this[_protected].onFinishCallbacks.push(safeCallback(callback, this.logger));\n    }\n    /**\n     * Register a callback function that will be called if there is an error while running the ad.\n     *\n     * @throws if ad unit is finished.\n     *\n     * @param callback will be called on ad unit error passing the Error instance  and an object with the adUnit and the  {@link VastChain}.\n     */\n    onError(callback) {\n        if (typeof callback !== 'function') {\n            throw new TypeError('Expected a callback function');\n        }\n        this[_protected].onErrorCallbacks.push(safeCallback(callback, this.logger));\n    }\n    /**\n     * @returns true if the ad unit is finished and false otherwise\n     */\n    isFinished() {\n        return this[_protected].finished;\n    }\n    /**\n     * @returns true if the ad unit has started and false otherwise\n     */\n    isStarted() {\n        return this[_protected].started;\n    }\n    /**\n     * This method resizes the ad unit to fit the available space in the passed {@link VideoAdContainer}\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @returns Promise that resolves once the unit was resized\n     */\n    async resize(width, height, mode) {\n        var _c, _d, _e, _f;\n        this[_protected].size = {\n            height,\n            viewmode: mode,\n            width\n        };\n        if (this.isStarted() && !this.isFinished() && this.icons) {\n            await ((_d = (_c = this[_protected]).removeIcons) === null || _d === void 0 ? void 0 : _d.call(_c));\n            await ((_f = (_e = this[_protected]).drawIcons) === null || _f === void 0 ? void 0 : _f.call(_e));\n        }\n    }\n}\n_a = _private, _b = _protected;\n","export const preventManualProgress = (videoElement) => {\n    // IOS video clock is very unreliable and we need a 3 seconds threshold to ensure that the user forwarded/rewound the ad\n    const PROGRESS_THRESHOLD = 3;\n    let previousTime = 0;\n    let skipAttempts = 0;\n    const preventAdSkip = () => {\n        // Ignore ended event if the Ad time was not 'near' the end\n        // and revert time to the previous 'valid' time\n        if (videoElement.duration - previousTime > PROGRESS_THRESHOLD) {\n            // this reduces the video jitter if the IOS skip button is pressed\n            videoElement.pause();\n            // we need to trigger the play to put the video element back in a valid state\n            videoElement.play();\n            videoElement.currentTime = previousTime;\n        }\n    };\n    const preventAdSeek = () => {\n        const { currentTime } = videoElement;\n        const progressDelta = Math.abs(currentTime - previousTime);\n        if (progressDelta > PROGRESS_THRESHOLD) {\n            skipAttempts += 1;\n            if (skipAttempts >= 2) {\n                videoElement.pause();\n            }\n            videoElement.currentTime = previousTime;\n        }\n        else {\n            previousTime = currentTime;\n        }\n    };\n    videoElement.addEventListener('timeupdate', preventAdSeek);\n    videoElement.addEventListener('ended', preventAdSkip);\n    return () => {\n        videoElement.removeEventListener('timeupdate', preventAdSeek);\n        videoElement.removeEventListener('ended', preventAdSkip);\n    };\n};\n","var _a;\nimport { linearEvents, ErrorCode, isVastErrorCode } from '../tracker';\nimport { getSkipOffset } from '../vastSelectors';\nimport { findBestMedia } from './helpers/media/findBestMedia';\nimport { once } from './helpers/dom/once';\nimport { setupMetricHandlers } from './helpers/metrics/setupMetricHandlers';\nimport { updateMedia } from './helpers/media/updateMedia';\nimport { AdUnitError } from './helpers/adUnitError';\nimport { VideoAdUnit, _protected } from './VideoAdUnit';\nconst { complete, error: errorEvent, skip } = linearEvents;\nconst _private = Symbol('_private');\n/**\n * This class provides everything necessary to run a Vast ad.\n */\nexport class VastAdUnit extends VideoAdUnit {\n    /**\n     * Creates a {@link VastAdUnit}.\n     *\n     * @param vastChain The {@link VastChain} with all the {@link VastResponse}\n     * @param videoAdContainer - container instance to place the ad\n     * @param options Options Map\n     */\n    constructor(vastChain, videoAdContainer, options = {}) {\n        super(vastChain, videoAdContainer, options);\n        this[_a] = {\n            handleMetric: (event, data) => {\n                var _b;\n                switch (event) {\n                    case complete: {\n                        this[_protected].finish();\n                        break;\n                    }\n                    case errorEvent: {\n                        if (data instanceof Error) {\n                            this.error = data;\n                            this.errorCode =\n                                ((_b = this.error) === null || _b === void 0 ? void 0 : _b.code) && isVastErrorCode(this.error.code)\n                                    ? this.error.code\n                                    : ErrorCode.VAST_PROBLEM_DISPLAYING_MEDIA_FILE;\n                        }\n                        this[_protected].onErrorCallbacks.forEach((callback) => callback(this.error, {\n                            adUnit: this,\n                            vastChain: this.vastChain\n                        }));\n                        this[_protected].finish();\n                        break;\n                    }\n                    case skip: {\n                        this.cancel();\n                        break;\n                    }\n                }\n                this.emit(event, {\n                    adUnit: this,\n                    data,\n                    type: event\n                });\n            },\n            drawIcons: async () => {\n                var _b, _c, _d, _e;\n                if (this.isFinished()) {\n                    return;\n                }\n                await ((_c = (_b = this[_protected]).drawIcons) === null || _c === void 0 ? void 0 : _c.call(_b));\n                if (((_e = (_d = this[_protected]).hasPendingIconRedraws) === null || _e === void 0 ? void 0 : _e.call(_d)) && !this.isFinished()) {\n                    const { videoElement } = this.videoAdContainer;\n                    once(videoElement, 'timeupdate', this[_private].drawIcons);\n                }\n            }\n        };\n        /** Ad unit type. Will be `VAST` for VastAdUnit */\n        this.type = 'VAST';\n        const { onFinishCallbacks } = this[_protected];\n        const { handleMetric } = this[_private];\n        this.hooks = options.hooks || {};\n        const removeMetricHandlers = setupMetricHandlers({\n            hooks: this.hooks,\n            pauseOnAdClick: this.pauseOnAdClick,\n            vastChain: this.vastChain,\n            videoAdContainer: this.videoAdContainer\n        }, handleMetric);\n        onFinishCallbacks.push(removeMetricHandlers);\n    }\n    /**\n     * Starts the ad unit.\n     *\n     * @throws if called twice.\n     * @throws if ad unit is finished.\n     */\n    async start() {\n        this[_protected].throwIfFinished();\n        if (this.isStarted()) {\n            throw new AdUnitError('VastAdUnit already started');\n        }\n        const inlineAd = this.vastChain[0].ad;\n        const { videoElement } = this.videoAdContainer;\n        const media = inlineAd && findBestMedia(inlineAd, this.videoAdContainer, this.hooks);\n        if (media) {\n            if (this.icons) {\n                await this[_private].drawIcons();\n            }\n            if (media === null || media === void 0 ? void 0 : media.src) {\n                videoElement.src = media.src;\n                this.assetUri = media.src;\n            }\n            videoElement.play();\n        }\n        else {\n            const adUnitError = new AdUnitError(\"Can't find a suitable media to play\");\n            adUnitError.code = ErrorCode.VAST_LINEAR_ASSET_MISMATCH;\n            this[_private].handleMetric(errorEvent, adUnitError);\n        }\n        this[_protected].started = true;\n    }\n    /**\n     * Resumes a previously paused ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    resume() {\n        this.videoAdContainer.videoElement.play();\n    }\n    /**\n     * Pauses the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    pause() {\n        this.videoAdContainer.videoElement.pause();\n    }\n    /**\n     * Skips the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    skip() {\n        const inlineAd = this.vastChain[0].ad;\n        const skipoffset = inlineAd && getSkipOffset(inlineAd);\n        const currentTimeMs = this.currentTime() * 1000;\n        if (typeof skipoffset === 'number' && currentTimeMs >= skipoffset) {\n            this[_private].handleMetric(skip);\n        }\n    }\n    /**\n     * Returns true if the ad is paused and false otherwise\n     */\n    paused() {\n        return this.videoAdContainer.videoElement.paused;\n    }\n    /**\n     * Sets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @param volume must be a value between 0 and 1;\n     */\n    setVolume(volume) {\n        this.videoAdContainer.videoElement.volume = volume;\n    }\n    /**\n     * Gets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @returns the volume of the ad unit.\n     */\n    getVolume() {\n        return this.videoAdContainer.videoElement.volume;\n    }\n    /**\n     * Cancels the ad unit.\n     *\n     * @throws if ad unit is finished.\n     */\n    cancel() {\n        this[_protected].throwIfFinished();\n        this.videoAdContainer.videoElement.pause();\n        this[_protected].finish();\n    }\n    /**\n     * Returns the duration of the ad Creative or 0 if there is no creative.\n     *\n     * @returns the duration of the ad unit.\n     */\n    duration() {\n        if (!this.isStarted()) {\n            return 0;\n        }\n        return this.videoAdContainer.videoElement.duration;\n    }\n    /**\n     * Returns the current time of the ad Creative or 0 if there is no creative.\n     *\n     * @returns the current time of the ad unit.\n     */\n    currentTime() {\n        if (!this.isStarted()) {\n            return 0;\n        }\n        return this.videoAdContainer.videoElement.currentTime;\n    }\n    /**\n     * This method resizes the ad unit to fit the available space in the passed {@link VideoAdContainer}\n     *\n     * @param width the new width of the ad container.\n     * @param height the new height of the ad container.\n     * @param viewmode fullscreen | normal | thumbnail\n     * @returns Promise that resolves once the unit was resized\n     */\n    async resize(width, height, viewmode) {\n        await super.resize(width, height, viewmode);\n        if (this.isStarted() && !this.isFinished()) {\n            const inlineAd = this.vastChain[0].ad;\n            const { videoElement } = this.videoAdContainer;\n            const media = inlineAd && findBestMedia(inlineAd, this.videoAdContainer, this.hooks);\n            if (media && videoElement.src !== media.src) {\n                updateMedia(videoElement, media);\n            }\n        }\n    }\n}\n_a = _private;\n","import { getClickThrough, getSkipOffset } from '../../../vastSelectors';\nimport { getProgressEvents } from '../progress/getProgressEvents';\nimport { safeCallback } from '../safeCallback';\nimport { metricHandlers } from './handlers';\nexport const setupMetricHandlers = ({ vastChain, videoAdContainer, hooks, pauseOnAdClick }, callback) => {\n    const [{ ad: inlineAd }] = vastChain;\n    const skipoffset = inlineAd && getSkipOffset(inlineAd);\n    const clickThroughUrl = inlineAd && getClickThrough(inlineAd);\n    const progressEvents = getProgressEvents(vastChain);\n    const data = Object.assign({ clickThroughUrl,\n        pauseOnAdClick,\n        progressEvents,\n        skipoffset }, hooks);\n    const stopHandlersFns = metricHandlers.map((handler) => safeCallback(handler(videoAdContainer, callback, data)));\n    return () => stopHandlersFns.forEach((disconnect) => disconnect());\n};\n","import { once } from '../dom/once';\nexport const updateMedia = (videoElement, mediaFile) => new Promise((resolve) => {\n    const state = {\n        currentTime: videoElement.currentTime,\n        playing: !videoElement.paused\n    };\n    if (state.playing) {\n        videoElement.pause();\n    }\n    if (mediaFile.src) {\n        videoElement.src = mediaFile.src;\n    }\n    videoElement.load();\n    once(videoElement, 'loadeddata', () => {\n        videoElement.currentTime = state.currentTime;\n        if (state.playing) {\n            videoElement.play();\n        }\n        resolve();\n    });\n});\n","export const SUPPORTED_MIMETYPES = [\n    'text/javascript',\n    'text/javascript1.0',\n    'text/javascript1.2',\n    'text/javascript1.4',\n    'text/jscript',\n    'application/javascript',\n    'application/x-javascript',\n    'text/ecmascript',\n    'text/ecmascript1.0',\n    'text/ecmascript1.2',\n    'text/ecmascript1.4',\n    'text/livescript',\n    'application/ecmascript',\n    'application/x-ecmascript'\n];\nexport const isSupported = ({ type }) => SUPPORTED_MIMETYPES.some((mimetype) => mimetype === type);\n","/* eslint-disable import/no-unused-modules */\nexport const handshakeVersion = 'handshakeVersion';\nexport const initAd = 'initAd';\nexport const resizeAd = 'resizeAd';\nexport const startAd = 'startAd';\nexport const stopAd = 'stopAd';\nexport const pauseAd = 'pauseAd';\nexport const resumeAd = 'resumeAd';\nexport const expandAd = 'expandAd';\nexport const skipAd = 'skipAd';\nexport const collapseAd = 'collapseAd';\nexport const getAdLinear = 'getAdLinear';\nexport const getAdWidth = 'getAdWidth';\nexport const getAdHeight = 'getAdHeight';\nexport const getAdExpanded = 'getAdExpanded';\nexport const getAdSkippableState = 'getAdSkippableState';\nexport const getAdRemainingTime = 'getAdRemainingTime';\nexport const getAdDuration = 'getAdDuration';\nexport const getAdVolume = 'getAdVolume';\nexport const getAdCompanions = 'getAdCompanions';\nexport const getAdIcons = 'getAdIcons';\nexport const setAdVolume = 'setAdVolume';\nexport const adLoaded = 'AdLoaded';\nexport const adStarted = 'AdStarted';\nexport const adStopped = 'AdStopped';\nexport const adSkipped = 'AdSkipped';\nexport const adSkippableStateChange = 'AdSkippableStateChange';\nexport const adSizeChange = 'AdSizeChange';\nexport const adLinearChange = 'AdLinearChange';\nexport const adDurationChange = 'AdDurationChange';\nexport const adExpandedChange = 'AdExpandedChange';\nexport const adRemainingTimeChange = 'AdRemainingTimeChange';\nexport const adVolumeChange = 'AdVolumeChange';\nexport const adImpression = 'AdImpression';\nexport const adVideoStart = 'AdVideoStart';\nexport const adVideoFirstQuartile = 'AdVideoFirstQuartile';\nexport const adVideoMidpoint = 'AdVideoMidpoint';\nexport const adVideoThirdQuartile = 'AdVideoThirdQuartile';\nexport const adVideoComplete = 'AdVideoComplete';\nexport const adClickThru = 'AdClickThru';\nexport const adInteraction = 'AdInteraction';\nexport const adUserAcceptInvitation = 'AdUserAcceptInvitation';\nexport const adUserMinimize = 'AdUserMinimize';\nexport const adUserClose = 'AdUserClose';\nexport const adPaused = 'AdPaused';\nexport const adPlaying = 'AdPlaying';\nexport const adLog = 'AdLog';\nexport const adError = 'AdError';\n/* eslint-enable import/no-unused-modules */\nexport const EVENTS = [\n    adLoaded,\n    adStarted,\n    adStopped,\n    adSkipped,\n    adSkippableStateChange,\n    adSizeChange,\n    adLinearChange,\n    adDurationChange,\n    adExpandedChange,\n    adRemainingTimeChange,\n    adVolumeChange,\n    adImpression,\n    adVideoStart,\n    adVideoFirstQuartile,\n    adVideoMidpoint,\n    adVideoThirdQuartile,\n    adVideoComplete,\n    adClickThru,\n    adInteraction,\n    adUserAcceptInvitation,\n    adUserMinimize,\n    adUserClose,\n    adPaused,\n    adPlaying,\n    adLog,\n    adError\n];\nexport const METHODS = [\n    handshakeVersion,\n    initAd,\n    resizeAd,\n    startAd,\n    stopAd,\n    pauseAd,\n    resumeAd,\n    expandAd,\n    collapseAd,\n    // VPAID 2.0 new methods\n    skipAd\n];\n","export const waitFor = (creativeAd, event, timeout) => new Promise((resolve, reject) => {\n    let timeoutId;\n    const handler = () => {\n        if (typeof timeout === 'number') {\n            window.clearTimeout(timeoutId);\n        }\n        creativeAd.unsubscribe(handler, event);\n        resolve();\n    };\n    if (typeof timeout === 'number') {\n        timeoutId = window.setTimeout(() => {\n            creativeAd.unsubscribe(handler, event);\n            reject(new Error(`Timeout waiting for event '${event}'`));\n        }, timeout);\n    }\n    creativeAd.subscribe(handler, event);\n});\n","import { waitFor } from './waitFor';\nconst WAIT_TIMEOUT = 5000;\nexport const callAndWait = (creativeAd, method, event, ...args\n// eslint-disable-next-line max-params\n) => {\n    const waitPromise = waitFor(creativeAd, event, WAIT_TIMEOUT);\n    const creativeMethod = creativeAd[method];\n    creativeMethod === null || creativeMethod === void 0 ? void 0 : creativeMethod.apply(creativeAd, args);\n    return waitPromise;\n};\n","import { handshakeVersion } from './api';\nconst major = (version) => {\n    const parts = version.split('.');\n    return parseInt(parts[0], 10);\n};\nconst isSupported = (supportedVersion, creativeVersion) => {\n    const creativeMajorNumber = major(creativeVersion);\n    if (creativeMajorNumber < 1) {\n        return false;\n    }\n    return creativeMajorNumber <= major(supportedVersion);\n};\nexport const handshake = (creativeAd, supportedVersion) => {\n    const creativeVersion = creativeAd[handshakeVersion](supportedVersion);\n    if (!isSupported(supportedVersion, creativeVersion)) {\n        throw new Error(`Creative Version '${creativeVersion}' not supported`);\n    }\n    return creativeVersion;\n};\n","var _a;\nimport { linearEvents, ErrorCode, isVastErrorCode } from '../tracker';\nimport { acceptInvitation, adCollapse } from '../tracker/nonLinearEvents';\nimport { getClickThrough } from '../vastSelectors';\nimport { volumeChanged, adProgress } from './adUnitEvents';\nimport { loadCreative } from './helpers/vpaid/loadCreative';\nimport { adLoaded, adStarted, adStopped, adPlaying, adPaused, startAd, stopAd, resumeAd, pauseAd, skipAd, setAdVolume, getAdVolume, getAdDuration, resizeAd, adSizeChange, adError, adVideoComplete, adSkipped, EVENTS, adVolumeChange, adImpression, adVideoStart, adVideoFirstQuartile, adVideoMidpoint, adVideoThirdQuartile, adUserAcceptInvitation, adUserMinimize, adUserClose, adDurationChange, adRemainingTimeChange, adClickThru, getAdIcons, getAdRemainingTime } from './helpers/vpaid/api';\nimport { waitFor } from './helpers/vpaid/waitFor';\nimport { callAndWait } from './helpers/vpaid/callAndWait';\nimport { handshake } from './helpers/vpaid/handshake';\nimport { initAd } from './helpers/vpaid/initAd';\nimport { AdUnitError } from './helpers/adUnitError';\nimport { VideoAdUnit, _protected } from './VideoAdUnit';\nconst { complete, mute, unmute, skip, start, firstQuartile, pause, resume, impression, midpoint, thirdQuartile, clickThrough, error: errorEvent, closeLinear, creativeView } = linearEvents;\n// NOTE some ads only allow one handler per event and we need to subscribe to the adLoaded to know the creative is loaded.\nconst VPAID_EVENTS = EVENTS.filter((event) => event !== adLoaded);\nconst DRAW_ICONS_TIMEOUT = 500;\nconst WAIT_STOPPED_TIMEOUT = 3000;\nconst _private = Symbol('_private');\nconst vpaidGeneralError = (payload) => {\n    const error = payload instanceof Error ? payload : new AdUnitError('VPAID general error');\n    if (!error.code || !isVastErrorCode(error.code)) {\n        error.code = ErrorCode.VPAID_ERROR;\n    }\n    return error;\n};\n/**\n * This class provides everything necessary to run a Vpaid ad.\n */\nexport class VpaidAdUnit extends VideoAdUnit {\n    /**\n     * Creates a {@link VpaidAdUnit}.\n     *\n     * @param vastChain The {@link VastChain} with all the {@link VastResponse}\n     * @param videoAdContainer container instance to place the ad\n     * @param options Options Map\n     */\n    constructor(vastChain, videoAdContainer, options = {}) {\n        super(vastChain, videoAdContainer, options);\n        this[_a] = {\n            evtHandler: {\n                [adClickThru]: (url, _id, playerHandles) => {\n                    if (playerHandles) {\n                        this[_private].handleClickThrough(url);\n                    }\n                    this.emit(clickThrough, {\n                        adUnit: this,\n                        type: clickThrough\n                    });\n                },\n                [adDurationChange]: () => {\n                    this.emit(adProgress, {\n                        adUnit: this,\n                        type: adProgress\n                    });\n                },\n                [adError]: (payload) => {\n                    this.error = vpaidGeneralError(payload);\n                    this.errorCode = this.error.code;\n                    this[_protected].onErrorCallbacks.forEach((callback) => callback(this.error, {\n                        adUnit: this,\n                        vastChain: this.vastChain\n                    }));\n                    this[_protected].finish();\n                    this.emit(errorEvent, {\n                        adUnit: this,\n                        type: errorEvent\n                    });\n                },\n                [adImpression]: () => {\n                    // NOTE: some ads forget to trigger the adVideoStart event. :(\n                    if (!this[_private].videoStart) {\n                        this[_private].handleVpaidEvent(adVideoStart);\n                    }\n                    this.emit(impression, {\n                        adUnit: this,\n                        type: impression\n                    });\n                },\n                [adPaused]: () => {\n                    this[_private].paused = true;\n                    this.emit(pause, {\n                        adUnit: this,\n                        type: pause\n                    });\n                },\n                [adPlaying]: () => {\n                    this[_private].paused = false;\n                    this.emit(resume, {\n                        adUnit: this,\n                        type: resume\n                    });\n                },\n                [adRemainingTimeChange]: () => {\n                    this.emit(adProgress, {\n                        adUnit: this,\n                        type: adProgress\n                    });\n                },\n                [adSkipped]: () => {\n                    this.cancel();\n                    this.emit(skip, {\n                        adUnit: this,\n                        type: skip\n                    });\n                },\n                [adStarted]: () => {\n                    this.emit(creativeView, {\n                        adUnit: this,\n                        type: creativeView\n                    });\n                },\n                [adStopped]: () => {\n                    this.emit(adStopped, {\n                        adUnit: this,\n                        type: adStopped\n                    });\n                    this[_protected].finish();\n                },\n                [adUserAcceptInvitation]: () => {\n                    this.emit(acceptInvitation, {\n                        adUnit: this,\n                        type: acceptInvitation\n                    });\n                },\n                [adUserClose]: () => {\n                    this.emit(closeLinear, {\n                        adUnit: this,\n                        type: closeLinear\n                    });\n                    this[_protected].finish();\n                },\n                [adUserMinimize]: () => {\n                    this.emit(adCollapse, {\n                        adUnit: this,\n                        type: adCollapse\n                    });\n                },\n                [adVideoComplete]: () => {\n                    this.emit(complete, {\n                        adUnit: this,\n                        type: complete\n                    });\n                },\n                [adVideoFirstQuartile]: () => {\n                    this.emit(firstQuartile, {\n                        adUnit: this,\n                        type: firstQuartile\n                    });\n                },\n                [adVideoMidpoint]: () => {\n                    this.emit(midpoint, {\n                        adUnit: this,\n                        type: midpoint\n                    });\n                },\n                [adVideoStart]: () => {\n                    if (!this[_private].videoStart) {\n                        this[_private].videoStart = true;\n                        this[_private].paused = false;\n                        this.emit(start, {\n                            adUnit: this,\n                            type: start\n                        });\n                    }\n                },\n                [adVideoThirdQuartile]: () => {\n                    this.emit(thirdQuartile, {\n                        adUnit: this,\n                        type: thirdQuartile\n                    });\n                },\n                [adVolumeChange]: () => {\n                    const volume = this.getVolume();\n                    this.emit(volumeChanged, {\n                        adUnit: this,\n                        type: volumeChanged\n                    });\n                    if (volume === 0 && !this[_private].muted) {\n                        this[_private].muted = true;\n                        this.emit(mute, {\n                            adUnit: this,\n                            type: mute\n                        });\n                    }\n                    if (volume > 0 && this[_private].muted) {\n                        this[_private].muted = false;\n                        this.emit(unmute, {\n                            adUnit: this,\n                            type: unmute\n                        });\n                    }\n                }\n            },\n            handleVpaidEvent: (event, ...args) => {\n                const handler = this[_private].evtHandler[event];\n                if (handler) {\n                    handler(...args);\n                }\n                this.emit(event, {\n                    adUnit: this,\n                    type: event\n                });\n            },\n            handleClickThrough: (url) => {\n                if (this.paused() && this.pauseOnAdClick) {\n                    this.resume();\n                    return;\n                }\n                const inlineAd = this.vastChain[0].ad;\n                const clickThroughUrl = typeof url === 'string' && url.length > 0\n                    ? url\n                    : inlineAd && getClickThrough(inlineAd);\n                if (this.pauseOnAdClick) {\n                    this.pause();\n                }\n                if (clickThroughUrl) {\n                    window.open(clickThroughUrl, '_blank');\n                }\n            },\n            getIcons: () => {\n                var _b;\n                if ((_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[getAdIcons]) {\n                    try {\n                        if (!this.creativeAd[getAdIcons]()) {\n                            delete this.icons;\n                        }\n                    }\n                    catch (_c) {\n                        delete this.icons;\n                    }\n                }\n            },\n            drawIcons: async () => {\n                var _b, _c, _d, _e;\n                if (this.isFinished()) {\n                    return;\n                }\n                await ((_c = (_b = this[_protected]).drawIcons) === null || _c === void 0 ? void 0 : _c.call(_b));\n                if (((_e = (_d = this[_protected]).hasPendingIconRedraws) === null || _e === void 0 ? void 0 : _e.call(_d)) && !this.isFinished()) {\n                    setTimeout(this[_private].drawIcons, DRAW_ICONS_TIMEOUT);\n                }\n            },\n            muted: false,\n            paused: true\n        };\n        /** Ad unit type. Will be `VPAID` for VpaidAdUnit */\n        this.type = 'VPAID';\n        this[_private].loadCreativePromise = loadCreative(vastChain, videoAdContainer);\n    }\n    /**\n     * Starts the ad unit.\n     *\n     * @throws if called twice.\n     * @throws if ad unit is finished.\n     */\n    async start() {\n        this[_protected].throwIfFinished();\n        if (this.isStarted()) {\n            throw new Error('VpaidAdUnit already started');\n        }\n        try {\n            this.creativeAd = (await this[_private]\n                .loadCreativePromise);\n            const adLoadedPromise = waitFor(this.creativeAd, adLoaded);\n            for (const creativeEvent of VPAID_EVENTS) {\n                this.creativeAd.subscribe(this[_private].handleVpaidEvent.bind(this, creativeEvent), creativeEvent);\n            }\n            this[_private].getIcons();\n            handshake(this.creativeAd, '2.0');\n            initAd(this.creativeAd, this.videoAdContainer, this.vastChain);\n            await adLoadedPromise;\n            // if the ad timed out while trying to load the videoAdContainer will be destroyed\n            if (this.videoAdContainer.isDestroyed()) {\n                return;\n            }\n            try {\n                const { videoElement } = this.videoAdContainer;\n                if (videoElement.muted) {\n                    this[_private].muted = true;\n                    this.setVolume(0);\n                }\n                else {\n                    this.setVolume(videoElement.volume);\n                }\n                await callAndWait(this.creativeAd, startAd, adStarted);\n                if (this.icons) {\n                    await this[_private].drawIcons();\n                }\n                this[_protected].started = true;\n            }\n            catch (_b) {\n                this.cancel();\n            }\n        }\n        catch (error) {\n            this[_private].handleVpaidEvent(adError, error);\n            throw error;\n        }\n    }\n    /**\n     * Resumes a previously paused ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    resume() {\n        var _b;\n        (_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[resumeAd]();\n    }\n    /**\n     * Pauses the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    pause() {\n        var _b;\n        (_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[pauseAd]();\n    }\n    /**\n     * Skip the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     */\n    skip() {\n        var _b;\n        (_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[skipAd]();\n    }\n    /**\n     * Returns true if the ad is paused and false otherwise\n     */\n    paused() {\n        return this.isFinished() || this[_private].paused;\n    }\n    /**\n     * Sets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @param volume must be a value between 0 and 1;\n     */\n    setVolume(volume) {\n        var _b;\n        (_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[setAdVolume](volume);\n    }\n    /**\n     * Gets the volume of the ad unit.\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @returns the volume of the ad unit.\n     */\n    getVolume() {\n        if (!this.creativeAd) {\n            return 0;\n        }\n        return this.creativeAd[getAdVolume]();\n    }\n    /**\n     * Cancels the ad unit.\n     *\n     * @throws if ad unit is finished.\n     */\n    async cancel() {\n        var _b;\n        this[_protected].throwIfFinished();\n        try {\n            const adStoppedPromise = this.creativeAd &&\n                waitFor(this.creativeAd, adStopped, WAIT_STOPPED_TIMEOUT);\n            (_b = this.creativeAd) === null || _b === void 0 ? void 0 : _b[stopAd]();\n            await adStoppedPromise;\n        }\n        catch (_c) {\n            this[_protected].finish();\n        }\n    }\n    /**\n     * Returns the duration of the ad Creative or 0 if there is no creative.\n     *\n     * Note: if the user has engaged with the ad, the duration becomes unknown and it will return 0;\n     *\n     * @returns the duration of the ad unit.\n     */\n    duration() {\n        if (!this.creativeAd) {\n            return 0;\n        }\n        const duration = this.creativeAd[getAdDuration]();\n        if (duration < 0) {\n            return 0;\n        }\n        return duration;\n    }\n    /**\n     * Returns the current time of the ad Creative or 0 if there is no creative.\n     *\n     * Note: if the user has engaged with the ad, the currentTime becomes unknown and it will return 0;\n     *\n     * @returns the current time of the ad unit.\n     */\n    currentTime() {\n        if (!this.creativeAd) {\n            return 0;\n        }\n        const remainingTime = this.creativeAd[getAdRemainingTime]();\n        if (remainingTime < 0) {\n            return 0;\n        }\n        return this.duration() - remainingTime;\n    }\n    /**\n     * This method resizes the ad unit to fit the available space in the passed {@link VideoAdContainer}\n     *\n     * @throws if ad unit is not started.\n     * @throws if ad unit is finished.\n     *\n     * @returns Promise that resolves once the unit was resized\n     */\n    async resize(width, height, viewmode) {\n        await super.resize(width, height, viewmode);\n        if (!this.creativeAd) {\n            return;\n        }\n        if (this.isStarted() && !this.isFinished()) {\n            const slot = this.videoAdContainer.slotElement;\n            if (slot) {\n                slot.style.height = `${height}px`;\n                slot.style.width = `${width}px`;\n            }\n        }\n        return callAndWait(this.creativeAd, resizeAd, adSizeChange, width, height, viewmode);\n    }\n}\n_a = _private;\n","import { getInteractiveFiles } from '../../../vastSelectors';\nimport { isSupported } from './isSupported';\nexport const loadCreative = async (vastChain, videoAdContainer) => {\n    const interactiveFiles = (vastChain[0].ad && getInteractiveFiles(vastChain[0].ad)) || [];\n    const creative = interactiveFiles.find(isSupported);\n    if (!creative || !creative.src) {\n        throw new TypeError('VastChain does not contain a supported vpaid creative');\n    }\n    const { src: source, type } = creative;\n    await videoAdContainer.addScript(source, { type });\n    const context = videoAdContainer.executionContext;\n    return context.getVPAIDAd();\n};\n","import { getCreativeData } from '../../../vastSelectors';\nimport { viewmode } from './viewmode';\nexport const initAd = (creativeAd, videoAdContainer, vastChain) => {\n    const { width, height } = videoAdContainer.element.getBoundingClientRect();\n    const mode = viewmode(width, height);\n    const desiredBitrate = -1;\n    const creativeData = getCreativeData(vastChain[0].XML);\n    videoAdContainer.addSlot(width, height);\n    const environmentVariables = {\n        slot: videoAdContainer.slotElement,\n        videoSlot: videoAdContainer.videoElement,\n        videoSlotCanAutoPlay: videoAdContainer.isOriginalVideoElement\n    };\n    creativeAd.initAd(width, height, mode, desiredBitrate, creativeData, environmentVariables);\n};\n","import { linearEvents, nonLinearEvents, trackLinearEvent, trackNonLinearEvent } from '../tracker';\nimport { VastAdUnit } from './VastAdUnit';\nimport { VpaidAdUnit } from './VpaidAdUnit';\nexport function createVideoAdUnit(vastChain, videoAdContainer, options) {\n    const { tracker, type } = options;\n    const adUnit = type === 'VPAID'\n        ? new VpaidAdUnit(vastChain, videoAdContainer, options)\n        : new VastAdUnit(vastChain, videoAdContainer, options);\n    Object.values(linearEvents).forEach((linearEvent) => adUnit.on(linearEvent, (event) => {\n        const { type: eventType, data } = event;\n        const payload = {\n            data,\n            errorCode: adUnit.errorCode,\n            tracker\n        };\n        trackLinearEvent(eventType, vastChain, payload);\n    }));\n    Object.values(nonLinearEvents).forEach((nonLinearEvent) => adUnit.on(nonLinearEvent, (event) => {\n        const payload = {\n            data: event.data,\n            tracker\n        };\n        trackNonLinearEvent(event.type, vastChain, payload);\n    }));\n    return adUnit;\n}\n","export class VastError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = 'VastError';\n        Object.setPrototypeOf(this, VastError.prototype);\n    }\n}\n","import { createVideoAdUnit } from '../../adUnit';\nimport { VideoAdContainer } from '../../adContainer';\nimport { ErrorCode } from '../../tracker';\nimport { getInteractiveFiles, getMediaFiles } from '../../vastSelectors';\nimport { canPlay } from '../../adUnit/helpers/media/canPlay';\nimport { start, closeLinear } from '../../tracker/linearEvents';\nimport { adStopped, adUserClose } from '../../adUnit/helpers/vpaid/api';\nimport { VastError } from '../../vastRequest/helpers/vastError';\nconst validate = (vastChain, videoAdContainer) => {\n    if (!Array.isArray(vastChain) || vastChain.length === 0) {\n        throw new TypeError('Invalid vastChain');\n    }\n    if (!(videoAdContainer instanceof VideoAdContainer)) {\n        throw new TypeError('Invalid VideoAdContainer');\n    }\n};\nconst hasVpaidCreative = (ad) => Boolean(getInteractiveFiles(ad));\nconst hasVastCreative = (ad, videoElement) => {\n    const mediaFiles = getMediaFiles(ad);\n    if (mediaFiles) {\n        return mediaFiles.some((mediaFile) => canPlay(videoElement, mediaFile));\n    }\n    return false;\n};\nconst startAdUnit = (adUnit, { onAdReady }) => new Promise((resolve, reject) => {\n    const createRejectHandler = (event) => () => reject(new Error(`Ad unit start rejected due to event '${event}'`));\n    adUnit.onError(reject);\n    adUnit.on(start, () => resolve(adUnit));\n    adUnit.on(adUserClose, createRejectHandler(adUserClose));\n    adUnit.on(closeLinear, createRejectHandler(closeLinear));\n    adUnit.on(adStopped, createRejectHandler(adStopped));\n    onAdReady(adUnit);\n    adUnit.start();\n});\nconst tryToStartVpaidAd = (vastChain, videoAdContainer, options) => {\n    const [{ ad: inlineAd }] = vastChain;\n    if (!inlineAd || !hasVpaidCreative(inlineAd)) {\n        const error = new VastError('No valid creative found in the passed VAST chain');\n        error.code = ErrorCode.VAST_MEDIA_FILE_NOT_FOUND;\n        throw error;\n    }\n    const adUnit = createVideoAdUnit(vastChain, videoAdContainer, Object.assign(Object.assign({}, options), { type: 'VPAID' }));\n    return startAdUnit(adUnit, options);\n};\nconst startVastAd = (vastChain, videoAdContainer, options) => {\n    const adUnit = createVideoAdUnit(vastChain, videoAdContainer, Object.assign(Object.assign({}, options), { type: 'VAST' }));\n    return startAdUnit(adUnit, options);\n};\nexport const startVideoAd = async (vastChain, videoAdContainer, options) => {\n    validate(vastChain, videoAdContainer);\n    try {\n        return await tryToStartVpaidAd(vastChain, videoAdContainer, options);\n    }\n    catch (error) {\n        const [{ ad: inlineAd }] = vastChain;\n        if (inlineAd && hasVastCreative(inlineAd, videoAdContainer.videoElement)) {\n            return startVastAd(vastChain, videoAdContainer, options);\n        }\n        throw error;\n    }\n};\n","class FetchError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = 'FetchError';\n        Object.setPrototypeOf(this, FetchError.prototype);\n    }\n}\nconst BAD_REQUEST = 400;\nexport const fetch = async (endpoint, options = {}) => {\n    const fetchOptions = Object.assign({ credentials: 'include' }, options);\n    const response = await window.fetch(endpoint, fetchOptions);\n    if (response.status >= BAD_REQUEST) {\n        const error = new FetchError(response.statusText);\n        error.response = response;\n        throw error;\n    }\n    return response;\n};\n","const requested = Symbol('requested');\nexport const markAdAsRequested = (ad) => {\n    ad[requested] = true;\n};\nexport const unmarkAdAsRequested = (ad) => {\n    delete ad[requested];\n};\nexport const hasAdBeenRequested = (ad) => Boolean(ad[requested]);\n","import { parseXml } from '../xml';\nimport { isVastErrorCode, ErrorCode } from '../tracker';\nimport { getWrapperOptions, getFirstAd, getVASTAdTagURI, hasAdPod, isInline, isWrapper } from '../vastSelectors';\nimport { fetch } from './helpers/fetch';\nimport { VastError } from './helpers/vastError';\nimport { markAdAsRequested } from './helpers/adUtils';\nconst validateChain = (vastChain, { wrapperLimit = 5 }) => {\n    if (vastChain.length > wrapperLimit) {\n        const error = new VastError('Wrapper Limit reached');\n        error.code = ErrorCode.VAST_TOO_MANY_REDIRECTS;\n        throw error;\n    }\n};\nconst fetchAdXML = async (adTag, options) => {\n    var _a;\n    let response;\n    try {\n        response = await fetch(adTag, options);\n        const XML = await response.text();\n        return { response, XML };\n    }\n    catch (error) {\n        error.code = ErrorCode.VAST_NONLINEAR_LOADING_FAILED;\n        (_a = error.response) !== null && _a !== void 0 ? _a : (error.response = response);\n        throw error;\n    }\n};\nconst parseVastXml = (xml) => {\n    try {\n        return parseXml(xml);\n    }\n    catch (error) {\n        error.code = ErrorCode.VAST_XML_PARSING_ERROR;\n        throw error;\n    }\n};\nconst getAd = (parsedXML) => {\n    try {\n        const ad = getFirstAd(parsedXML);\n        if (ad) {\n            markAdAsRequested(ad);\n            return ad;\n        }\n        throw new Error('No Ad');\n    }\n    catch (error) {\n        error.code = ErrorCode.VAST_NO_ADS_AFTER_WRAPPER;\n        throw error;\n    }\n};\nconst validateResponse = ({ ad, parsedXML }, { allowMultipleAds = true, followAdditionalWrappers = true }) => {\n    if (!isWrapper(ad) && !isInline(ad)) {\n        const error = new VastError('Invalid VAST, ad contains neither Wrapper nor Inline');\n        error.code = ErrorCode.VAST_SCHEMA_VALIDATION_ERROR;\n        throw error;\n    }\n    if (hasAdPod(parsedXML) && !allowMultipleAds) {\n        const error = new VastError('Multiple ads are not allowed');\n        error.code = ErrorCode.VAST_UNEXPECTED_MEDIA_FILE;\n        throw error;\n    }\n    if (isWrapper(ad) && !followAdditionalWrappers) {\n        const error = new VastError('To follow additional wrappers is not allowed');\n        error.code = ErrorCode.VAST_UNEXPECTED_AD_TYPE;\n        throw error;\n    }\n};\nconst getOptions = (vastChain, options) => {\n    const [parentAd] = vastChain;\n    const parentAdIsWrapper = Boolean(parentAd) && parentAd.ad && isWrapper(parentAd.ad);\n    const wrapperOptions = parentAdIsWrapper && parentAd.ad ? getWrapperOptions(parentAd.ad) : {};\n    return Object.assign(Object.assign({}, wrapperOptions), options);\n};\n/**\n * Request the ad using the passed ad tag and returns an array with the {@link VastResponse} needed to get an inline ad.\n *\n * @param adTag The VAST ad tag request url.\n * @param options Options Map. The allowed properties are:\n * @param vastChain Optional vastChain with the previous VAST responses.\n * @returns Returns a Promise that will resolve with a VastChain with the newest VAST response at the beginning of the array.\n * If the {@link VastChain} had an error. The first VAST response of the array will contain an error and an errorCode entry.\n */\nexport const requestAd = async (adTag, options, vastChain = []) => {\n    var _a;\n    const vastAdResponse = {\n        requestTag: adTag\n    };\n    let epoch;\n    let timeout;\n    try {\n        const resultOptions = getOptions(vastChain, options);\n        validateChain(vastChain, resultOptions);\n        let fetchPromise = fetchAdXML(adTag, resultOptions);\n        if (typeof resultOptions.timeout === 'number') {\n            timeout = resultOptions.timeout;\n            epoch = Date.now();\n            fetchPromise = Promise.race([\n                fetchPromise,\n                new Promise((_resolve, reject) => {\n                    setTimeout(() => {\n                        const error = new VastError('RequestAd timeout');\n                        error.code = ErrorCode.VAST_LOAD_TIMEOUT;\n                        reject(error);\n                    }, timeout);\n                })\n            ]);\n        }\n        const { response, XML } = await fetchPromise;\n        vastAdResponse.response = response;\n        vastAdResponse.XML = XML;\n        vastAdResponse.parsedXML = parseVastXml(vastAdResponse.XML);\n        vastAdResponse.ad = getAd(vastAdResponse.parsedXML);\n        validateResponse(vastAdResponse, resultOptions);\n        if (isWrapper(vastAdResponse.ad)) {\n            if (epoch && timeout) {\n                timeout -= Date.now() - epoch;\n            }\n            return requestAd(getVASTAdTagURI(vastAdResponse.ad), Object.assign(Object.assign({}, resultOptions), { timeout }), [vastAdResponse, ...vastChain]);\n        }\n        return [vastAdResponse, ...vastChain];\n    }\n    catch (error) {\n        /* istanbul ignore if */\n        if (!isVastErrorCode(error.code)) {\n            error.code = ErrorCode.UNKNOWN_ERROR;\n        }\n        vastAdResponse.errorCode = error.code;\n        vastAdResponse.error = error;\n        (_a = vastAdResponse.response) !== null && _a !== void 0 ? _a : (vastAdResponse.response = error.response);\n        return [vastAdResponse, ...vastChain];\n    }\n};\n","import saneError from 'sane-domparser-error';\nimport { xmlToJson } from './xmlToJson';\nexport const xml2js = (parser, xmlText) => {\n    const xmlDom = parser.parseFromString(xmlText, 'application/xml');\n    saneError.failOnParseError(xmlDom);\n    return xmlToJson(xmlDom);\n};\n","import { getVASTAdTagURI, isWrapper } from '../vastSelectors';\nimport { requestAd } from './requestAd';\nimport { getNextAd } from './helpers/getNextAd';\nimport { markAdAsRequested } from './helpers/adUtils';\nconst validateChain = (vastChain) => {\n    if (!Array.isArray(vastChain)) {\n        throw new TypeError('Invalid VAST chain');\n    }\n    if (vastChain.length === 0) {\n        throw new Error('No next ad to request');\n    }\n};\n/**\n * Requests the next ad in the VAST Chain.\n *\n * @param vastChain Array of {@link VastResponse}.\n * @param options Options Map. The allowed properties are:\n * @returns Returns a Promise that will resolve with a VastChain with the newest VAST response at the beginning of the array.\n * If the {@link VastChain} had an error. The first VAST response of the array will contain an error and an errorCode entry.\n */\nexport const requestNextAd = (vastChain, options) => {\n    validateChain(vastChain);\n    const [vastResponse] = vastChain;\n    const nextAd = getNextAd(vastResponse, options);\n    if (nextAd) {\n        const newVastResponse = Object.assign(Object.assign({}, vastResponse), { ad: nextAd });\n        const newVastChain = [newVastResponse, ...vastChain.slice(1)];\n        markAdAsRequested(nextAd);\n        if (isWrapper(nextAd)) {\n            return requestAd(getVASTAdTagURI(nextAd), options, newVastChain);\n        }\n        return Promise.resolve(newVastChain);\n    }\n    return requestNextAd(vastChain.slice(1), options);\n};\n","import { hasAdPod, getAds, getPodAdSequence, isPodAd } from '../../vastSelectors';\nimport { hasAdBeenRequested } from './adUtils';\nconst getNextPod = (currentPod, ads) => {\n    const nextPodSequence = (getPodAdSequence(currentPod) || 0) + 1;\n    return ads.find((ad) => getPodAdSequence(ad) === nextPodSequence);\n};\nexport const getNextAd = ({ ad, parsedXML }, { fallbackOnNoAd = true, useAdBuffet = false }) => {\n    const ads = getAds(parsedXML);\n    const availableAds = ads.filter((adDefinition) => !hasAdBeenRequested(adDefinition));\n    let nextAd;\n    if (hasAdPod(parsedXML)) {\n        if (useAdBuffet) {\n            nextAd = availableAds.find((adDefinition) => !isPodAd(adDefinition));\n        }\n        if (ad && !nextAd) {\n            nextAd = getNextPod(ad, availableAds);\n        }\n    }\n    else if (availableAds.length > 0 && fallbackOnNoAd) {\n        const [availableAd] = availableAds;\n        nextAd = availableAd;\n    }\n    return nextAd;\n};\n","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { trackError, isVastErrorCode, ErrorCode } from '../tracker';\nimport { requestAd, requestNextAd } from '../vastRequest';\nimport { VastError } from '../vastRequest/helpers/vastError';\nimport { getInteractiveFiles } from '../vastSelectors';\nimport { isIos } from '../utils/isIos';\nimport { run } from './run';\nconst isVpaid = (vastChain) => Boolean(vastChain[0].ad && getInteractiveFiles(vastChain[0].ad));\nconst validateVastChain = (vastChain, options) => {\n    var _a;\n    if (!vastChain || vastChain.length === 0) {\n        throw new Error('Invalid VastChain');\n    }\n    const [lastVastResponse] = vastChain;\n    if (!options.vpaidEnabled && isVpaid(vastChain)) {\n        const error = new VastError('VPAID ads are not supported by the current player');\n        error.code = ErrorCode.VAST_UNEXPECTED_AD_TYPE;\n        lastVastResponse.errorCode = ErrorCode.VAST_UNEXPECTED_AD_TYPE;\n        lastVastResponse.error = error;\n    }\n    if (lastVastResponse.error) {\n        throw lastVastResponse.error;\n    }\n    if (typeof ((_a = options.hooks) === null || _a === void 0 ? void 0 : _a.validateVastResponse) === 'function') {\n        options.hooks.validateVastResponse(vastChain);\n    }\n};\nconst callbackHandler = (callback) => (...args) => {\n    if (typeof callback === 'function') {\n        callback(...args);\n    }\n};\nconst transformVastResponse = (vastChain, { hooks }) => {\n    if (typeof (hooks === null || hooks === void 0 ? void 0 : hooks.transformVastResponse) === 'function') {\n        return hooks.transformVastResponse(vastChain);\n    }\n    return vastChain;\n};\nconst handleVastError = (error, vastChain, tracker) => {\n    var _a;\n    let errorCode = ((_a = vastChain === null || vastChain === void 0 ? void 0 : vastChain[0]) === null || _a === void 0 ? void 0 : _a.errorCode) || (error === null || error === void 0 ? void 0 : error.code);\n    if (vastChain && errorCode) {\n        if (!isVastErrorCode(errorCode)) {\n            errorCode = ErrorCode.UNKNOWN_ERROR;\n        }\n        trackError(vastChain, {\n            errorCode,\n            tracker\n        });\n    }\n};\nconst waterfall = async (fetchVastChain, placeholder, _a) => {\n    var { isCanceled } = _a, options = __rest(_a, [\"isCanceled\"]);\n    let vastChain;\n    let runEpoch;\n    let adUnit;\n    const { onAdStart, onError, onRunFinish } = options;\n    try {\n        if (typeof options.timeout === 'number') {\n            runEpoch = Date.now();\n        }\n        vastChain = await fetchVastChain();\n        if (isCanceled()) {\n            onRunFinish();\n            return;\n        }\n        if (options.timeout && runEpoch) {\n            const newEpoch = Date.now();\n            options.timeout -= newEpoch - runEpoch;\n            runEpoch = newEpoch;\n        }\n        validateVastChain(vastChain, options);\n        adUnit = await run(transformVastResponse(vastChain, options), placeholder, Object.assign({}, options));\n        if (isCanceled()) {\n            adUnit.cancel();\n            onRunFinish();\n            return;\n        }\n        adUnit.onError(onError);\n        adUnit.onFinish(onRunFinish);\n        onAdStart(adUnit);\n    }\n    catch (error) {\n        handleVastError(error, vastChain, options.tracker);\n        onError(error, {\n            adUnit,\n            vastChain\n        });\n        if (!vastChain || isCanceled()) {\n            onRunFinish();\n            return;\n        }\n        if (options.timeout && runEpoch) {\n            options.timeout -= Date.now() - runEpoch;\n        }\n        if (runEpoch && options.timeout && options.timeout <= 0) {\n            onRunFinish();\n            return;\n        }\n        waterfall(() => requestNextAd(vastChain, options), placeholder, Object.assign(Object.assign({}, options), { isCanceled }));\n    }\n};\n/**\n * Will try to start one of the ads returned by the `adTag`. It will keep trying until it times out or it runs out of ads.\n *\n * @param adTag The VAST ad tag request url.\n * @param placeholder placeholder element that will contain the video ad.\n * @param options Options Map\n * @returns CancelFunction function. If called it will cancel the ad run. {@link runWaterfall~onRunFinish} will still be called;\n */\nexport const runWaterfall = (adTag, placeholder, options) => {\n    var _a, _b, _c;\n    let canceled = false;\n    let adUnit;\n    const isCanceled = () => canceled;\n    const onAdStartHandler = callbackHandler(options.onAdStart);\n    const onAdStart = (newAdUnit) => {\n        adUnit = newAdUnit;\n        onAdStartHandler(adUnit);\n    };\n    const resultOptions = Object.assign(Object.assign({ vpaidEnabled: true }, options), { onAdReady: callbackHandler(options.onAdReady), onAdStart, onError: callbackHandler(options.onError), onRunFinish: callbackHandler(options.onRunFinish) });\n    // NOTE: It seems that if the video doesn't load synchronously inside a touchend or click event handler, the user gesture breaks on iOS and it won't allow a play.\n    const shouldLoad = isIos() &&\n        ((_a = options.videoElement) === null || _a === void 0 ? void 0 : _a.paused) &&\n        ((_b = options.videoElement) === null || _b === void 0 ? void 0 : _b.canPlayType('application/vnd.apple.mpegurl'));\n    if (shouldLoad) {\n        (_c = options.videoElement) === null || _c === void 0 ? void 0 : _c.load();\n    }\n    waterfall(() => requestAd(adTag, resultOptions), placeholder, Object.assign(Object.assign({}, resultOptions), { isCanceled }));\n    return () => {\n        canceled = true;\n        if (adUnit && !adUnit.isFinished()) {\n            adUnit.cancel();\n        }\n    };\n};\n","import { trackError, ErrorCode } from '../tracker';\nimport { createVideoAdContainer } from '../adContainer';\nimport { startVideoAd } from './helpers/startVideoAd';\n/**\n * Will try to start video ad in the passed {@link VastChain} and return the started VideoAdUnit.\n * If there is an error starting the ad or it times out (by throw I mean that it will reject promise with the error).\n *\n * @param vastChain The {@link VastChain} with all the {@link VastResponse}s.\n * @param placeholder Element that will contain the video ad.\n * @param options - Options Map.\n * @returns The video ad unit.\n */\nexport const run = async (vastChain, placeholder, options) => {\n    let videoAdContainer;\n    try {\n        const { timeout } = options;\n        videoAdContainer = createVideoAdContainer(placeholder, options.videoElement);\n        let adUnitPromise = startVideoAd(vastChain, videoAdContainer, options);\n        if (typeof timeout === 'number') {\n            let timedOut = false;\n            let timeoutId;\n            const timeoutPromise = new Promise((_resolve, reject) => {\n                timeoutId = window.setTimeout(() => {\n                    const { tracker } = options;\n                    trackError(vastChain, {\n                        errorCode: ErrorCode.VAST_MEDIA_LOAD_TIMEOUT,\n                        tracker\n                    });\n                    timedOut = true;\n                    reject(new Error('Timeout while starting the ad'));\n                }, options.timeout);\n            });\n            const waitAdUnit = async () => {\n                const newAdUnit = await adUnitPromise;\n                if (timedOut) {\n                    if (newAdUnit.isStarted()) {\n                        newAdUnit.cancel();\n                    }\n                }\n                else {\n                    clearTimeout(timeoutId);\n                }\n                return newAdUnit;\n            };\n            adUnitPromise = Promise.race([waitAdUnit(), timeoutPromise]);\n        }\n        const adUnit = await adUnitPromise;\n        adUnit.onFinish(() => {\n            videoAdContainer === null || videoAdContainer === void 0 ? void 0 : videoAdContainer.destroy();\n        });\n        return adUnit;\n    }\n    catch (error) {\n        videoAdContainer === null || videoAdContainer === void 0 ? void 0 : videoAdContainer.destroy();\n        throw error;\n    }\n};\n","/* eslint-disable no-console */\nimport { runWaterfall } from '../src';\nimport './styles.css';\ndocument.addEventListener('DOMContentLoaded', () => {\n    const textArea = document.querySelector('#adTag');\n    const testButton = document.querySelector('.vast-test-btn');\n    const videoElement = document.querySelector('.vast-media video');\n    const videoAdContainer = document.querySelector('.video-ad-container');\n    let adUnit;\n    const onAdReady = (newAdUnit) => {\n        adUnit = newAdUnit;\n        console.log('### onAdReady', adUnit);\n        const eventHandler = (event) => {\n            console.log(`### ${event.type}`, event.adUnit);\n        };\n        [\n            'pause',\n            'resume',\n            'finish',\n            'impression',\n            'start',\n            'skip',\n            'firstQuartile',\n            'midpoint',\n            'thirdQuartile',\n            'complete'\n        ].forEach((eventType) => {\n            adUnit.on(eventType, eventHandler);\n        });\n    };\n    const requestAdRun = () => {\n        const adTag = textArea.value;\n        const source = videoElement.src;\n        const resumeContent = () => {\n            videoElement.play();\n            videoElement.removeEventListener('contentloadedmetadata', resumeContent);\n            videoElement.removeEventListener('canplay', resumeContent);\n        };\n        const onError = (error) => {\n            console.log('### onError', error);\n        };\n        const onRunFinish = () => {\n            console.log('### onRunFinish');\n            videoAdContainer.classList.remove('active');\n            if (videoElement.src === source) {\n                videoElement.play();\n            }\n            else {\n                videoElement.addEventListener('contentloadedmetadata', resumeContent);\n                videoElement.addEventListener('canplay', resumeContent);\n                videoElement.src = source;\n                videoElement.load();\n            }\n        };\n        videoAdContainer.classList.add('active');\n        videoElement.pause();\n        videoElement.currentTime = 0;\n        console.log('### adTag', adTag);\n        runWaterfall(adTag, videoAdContainer, {\n            onAdReady,\n            onError,\n            onRunFinish,\n            timeout: 15000,\n            videoElement,\n            credentials: 'omit'\n        });\n    };\n    textArea.addEventListener('change', () => {\n        const adTag = textArea.value;\n        if (adTag) {\n            testButton.classList.add('active');\n            testButton.addEventListener('click', requestAdRun);\n        }\n        else {\n            testButton.classList.remove('active');\n            testButton.removeEventListener('click', requestAdRun);\n        }\n    });\n});\n","export const isIos = () => /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n"],"names":["root","factory","exports","module","define","amd","a","i","self","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","freeGlobal","g","Object","freeSelf","Function","objectToString","prototype","toString","nativeMax","Math","max","nativeMin","min","now","Date","isObject","value","type","toNumber","isObjectLike","call","isSymbol","other","valueOf","replace","isBinary","test","slice","func","wait","options","lastArgs","lastThis","maxWait","result","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","args","thisArg","undefined","apply","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","remainingWait","debounced","isInvoking","arguments","this","leadingEdge","cancel","clearTimeout","flush","errorMessagePatterns","RegExp","failOnParseError","doc","errorMessage","Error","parseError","documentElement","tagName","namespaceURI","childNodes","length","nodeName","getParseError","errorNode","node","s","match","content","XMLSerializer","Array","map","serializeToString","join","exec","extractParseError","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","definition","key","o","defineProperty","enumerable","get","globalThis","e","window","obj","prop","hasOwnProperty","r","Symbol","toStringTag","ErrorCode","isVastErrorCode","code","values","includes","complete","clickThrough","error","firstQuartile","impression","viewable","notViewable","viewUndetermined","midpoint","mute","pause","playerCollapse","exitFullscreen","playerExpand","fullscreen","progress","resume","rewind","skip","start","thirdQuartile","unmute","iconClick","iconView","closeLinear","creativeView","linearEvents","otherAdInteraction","timeSpentViewing","acceptInvitation","adCollapse","nonLinearEvents","close","NodeType","NODE_TYPE","ELEMENT","TEXT","DOCUMENT_TYPE","DOCUMENT","xmlToJson","_a","nodeType","getNodeType","element","Element","attributes","fromEntries","from","attribute","nodeValue","getNodeAttributes","name","toLowerCase","Text","CDATASection","text","trim","getNodeText","children","_b","hasChildNodes","filter","childNode","keys","Number","elements","childElement","push","getNodeChildren","getChildren","childName","find","toUpperCase","getAll","childrenName","filterChildrenByName","firstChild","getAttributes","attributeName","parser","DOMParser","durationString","durationRegex","hours","minutes","seconds","ms","durationInMs","isNaN","parseOffset","offset","isPercentage","hasLinear","creative","ad","adTypeElement","creativesElement","getTrackingEvent","trackingEventElement","event","uri","getLinearTrackingEvents","eventName","creativeElement","linearElement","trackingEventsElement","trackingEventElements","trackingEvents","filteredEvents","formatSize","size","formatPosition","position","getIcons","linearCreativeElement","iconsElement","iconElements","iconElement","assign","duration","height","program","pxratio","width","xPosition","yPosition","getIconAttributes","staticResourceElement","htmlResourceElement","indexFrameResourceElement","staticResource","htmlResource","iFrameResource","getIconResource","iconTrackingElements","iconViewTrackingElement","Boolean","iconViewTracking","getIconViewTracking","iconClicksElement","iconClickThroughElement","iconClickTrackingElements","iconClickTrackingElement","iconClickThrough","iconClickTracking","getIconClicks","getBooleanValue","compareBySequence","itemA","itemB","itemASequenceString","itemBSequenceString","itemASequence","itemBSequence","getAds","parsedVast","vastElement","ads","getPodAdSequence","sequenceString","sequence","isPodAd","hasAdPod","isArray","getVASTAdTagURI","wrapperElement","vastAdTagURIElement","getViewable","viewableImpression","viewableElements","universalAdIdElement","universalAdId","mediaFilesElement","mediaFileElements","mediaFileElement","source","apiFramework","bitrate","codec","delivery","id","maintainAspectRatio","maxBitrate","minBitrate","scalable","src","interactiveFiles","interactiveElements","interactiveElement","getInteractiveCreativeFiles","mediaFiles","getVideoClicksElement","videoClicksElement","clickThroughElement","getSkipOffset","skipoffset","pixelTracker","urlMacro","data","img","Image","macro","parsedMacro","macroData","upperKeysMap","forEach","toUpperKeys","CACHEBUSTING","round","random","TIMESTAMP","toISOString","encodeURIComponent","parseMacro","trackError","vastChain","errorCode","tracker","parsedXML","errorURIs","errors","getAdErrorURI","getVastErrorURI","createVastEventTracker","trackingEventSelector","eventSelector","selectors","trackingURIs","getElements","linearTrackingEventSelector","linearTrackers","clickTrackingElements","customClickElements","_vastChain","trackUrl","impressions","notViewableElements","progressUri","viewUndeterminedElements","nonLinearAdsElement","getNonLinearTrackingEvents","getContentDocument","iframeElement","contentDocument","contentWindow","document","supported","createElement","createBaseIframe","iframe","setAttribute","style","margin","padding","border","nextId","namespace","count","unique","VideoAdContainer","constructor","placeholder","videoElement","destroyed","readyPromise","adContainer","classList","add","createAdContainer","isOriginalVideoElement","video","createAdVideoElement","appendChild","addScript","isDestroyed","Promise","resolve","reject","targetOrigin","iframeContent","origin","protocol","hostname","port","location","getOrigin","write","removeChild","srcdoc","handleMessage","removeEventListener","addEventListener","createIframe","executionContext","body","async","defer","script","scriptPlaceholder","onerror","URIError","onload","currentScript","parentNode","head","loadScript","addSlot","slotElement","slot","cursor","left","top","createSlot","destroy","removePromise","zIndex","mimeMap","avi","flv","m3u8","m4v","mov","mp4","mpd","ogv","ts","webm","wmv","canPlay","mediaFile","canPlayType","extension","guessMimeType","getRectParams","rect","aspectRatio","floor","getMediaByDefaultBestFit","screenRect","screenParams","sort","mediaFileA","mediaFileB","mediaFileAParams","mediaFileBParams","widthDeltaA","abs","widthDeltaB","sortMediaByBestFit","findBestMedia","inlineAd","videoAdContainer","getMediaFile","getBoundingClientRect","supportedMediaFiles","once","listener","handler","safeCallback","callback","logger","createDefaultSkipControl","skipButton","innerHTML","bottom","right","volumeChanged","finish","adProgress","percentageProgress","currentTime","isCompleted","isMuted","muted","volume","toFixedDigits","number_","digits","formattedNumber","String","formatProgress","secondsToMilliseconds","isValid","offsetIsValid","parseFloat","uriIsValid","offsetToMs","createDefaultClickControl","anchor","metricHandlers","clickThroughUrl","pauseOnAdClick","createClickControl","isVirtual","contains","HTMLAnchorElement","href","target","onclick","stopPropagation","paused","preventDefault","play","errorHandler","mediaError","VAST_PROBLEM_DISPLAYING_MEDIA_FILE","fullscreenEventNames","fullscreenOn","fullscreenchangeHandler","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","started","impressionHandler","playHandler","pauseHandler","progressEvents","playedMs","previousCurrentTime","pendingEvents","progressHandler","delta","stillPending","toCall","reduce","accumulator","contentplayhead","timeupdateHandler","createSkipControl","skipControl","skipHandler","currentTimeMs","passFirstQuartile","passMidPoint","passThirdQuartile","completed","events","isFired","isPassFirstQuartile","isPassMidPoint","isPassThirdQuartile","timeUpdateHandler","endedHandler","wasMuted","volumechangeHandler","AdUnitError","message","super","setPrototypeOf","MutationObserver","WebKitMutationObserver","MozMutationObserver","noop","sizeMutationAttributes","mutationHandlers","observerKey","resizeHandlers","resizeElement","onElementResize","threshold","validate","makeSizeId","clientHeight","clientWidth","lastSize","checkElementHandler","currentSize","stopObservingMutations","execHandlers","observer","mutations","index","observe","characterData","childList","createResizeMO","_c","disconnect","onMutation","stopListeningToResize","createResizeElement","getComputedStyle","onResize","IntersectionObserver","intersectionHandlers","visibilityHandlers","lastIntersectionEntries","onElementVisibilityChange","viewabilityOffset","lastIsInViewport","visibilityHandler","entries","entry","isInViewport","hidden","intersectionRatio","stopObservingIntersection","rootMargin","_item","onIntersection","stopListeningToVisibilityChange","_target","onVisibilityChange","Emitter","console","on","removeListener","eventListeners","existedListener","_","removeAllListeners","emit","hasListeners","stack","getResource","indexFrameResource","UNKNOWN","chooseByPxRatio","icons","devicePixelRatio","iconA","iconB","sortIconByBestPxratio","retrieveIcons","uniqIcons","array","uniqValue","seen","item","uniqBy","uniqByResource","byProgram","icon","groupIconsByProgram","chooseIcons","waitFor","resolvePromise","rejectPromise","pending","promise","cancelOnce","FetchError","noopResource","loadResource","resourceElement","image","createStaticResource","divElement","endpoint","response","fetch","contentType","headers","status","statusText","normalisedCT","some","allowedType","isValidContentType","fetchHtml","then","html","dispatchEvent","CustomEvent","catch","createHtmlResource","frameBorder","createIframeResource","createResource","resourceErrorWait","resourceLoadWait","cleanUp","calculateArea","canBeRendered","newIcon","config","thereIsSpace","drawnIcons","placeholderArea","hasSpace","isWithinTheContentArea","phRect","withinBoundaries","doesNotOverlap","drawnIcon","overlap","withoutOverlaps","renderIcons","onIconClick","iconsToShow","otherIcons","currentTimeInMs","videoDurationInMs","canBeShown","renderedIcon","iconResource","HTMLIFrameElement","HTMLImageElement","pointerEvents","Event","wrapWithClickThrough","createIcon","updatedIcon","signature","oldSignature","isCustomXposition","dIcon","dynamicPos","iconWidth","phWidth","drawnIconsWidth","calculateIconLeft","iconHeight","phHeight","isCustomYPosition","updated","updateIcon","updateIconElement","renderIcon","log","firstRenderPending","addIcons","onIconView","rest","t","p","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","drawIcons","hasPendingIconRedraws","iconsPendingToRedraw","iconsPendingToBeRemoved","removeIcons","removeDrawnIcons","viewmode","screen","_private","_protected","VideoAdUnit","viewability","responsive","adUnit","onFinishCallbacks","setupViewableImpression","timeoutId","unsubscribe","visible","isFinished","handleViewableImpression","setupViewability","setupResponsive","previousSize","resize","finished","onErrorCallbacks","throwIfCalled","throwIfFinished","previousTime","skipAttempts","preventAdSkip","preventAdSeek","preventManualProgress","setVolume","_volume","getVolume","onFinish","onError","isStarted","mode","_d","_e","_f","VastAdUnit","handleMetric","errorEvent","hooks","removeMetricHandlers","accumulated","getProgressEvents","stopHandlersFns","setupMetricHandlers","media","assetUri","adUnitError","VAST_LINEAR_ASSET_MISMATCH","state","playing","load","updateMedia","SUPPORTED_MIMETYPES","isSupported","mimetype","getAdIcons","adLoaded","adStarted","adStopped","adSkipped","adSizeChange","adDurationChange","adRemainingTimeChange","adVolumeChange","adImpression","adVideoStart","adVideoFirstQuartile","adVideoMidpoint","adVideoThirdQuartile","adVideoComplete","adClickThru","adUserAcceptInvitation","adUserMinimize","adUserClose","adPaused","adPlaying","adError","EVENTS","creativeAd","timeout","subscribe","callAndWait","method","waitPromise","creativeMethod","major","version","parts","split","VPAID_EVENTS","VpaidAdUnit","evtHandler","url","_id","playerHandles","handleClickThrough","payload","VPAID_ERROR","vpaidGeneralError","videoStart","handleVpaidEvent","open","loadCreativePromise","getVPAIDAd","loadCreative","adLoadedPromise","creativeEvent","bind","supportedVersion","creativeVersion","creativeMajorNumber","handshake","creativeData","xml","linearContent","getLinearContent","AdParameters","getAdParametersContent","xmlEncoded","getXmlEncodedValue","XML","environmentVariables","videoSlot","videoSlotCanAutoPlay","initAd","adStoppedPromise","remainingTime","createVideoAdUnit","linearEvent","eventType","linearTracker","trackLinearEvent","nonLinearEvent","trackNonLinearEvent","VastError","startAdUnit","onAdReady","createRejectHandler","startVideoAd","VAST_MEDIA_FILE_NOT_FOUND","tryToStartVpaidAd","hasVastCreative","startVastAd","requested","markAdAsRequested","requestAd","adTag","vastAdResponse","requestTag","epoch","resultOptions","parentAd","wrapperOptions","allowMultipleAds","fallbackOnNoAd","followAdditionalWrappers","getWrapperOptions","getOptions","wrapperLimit","VAST_TOO_MANY_REDIRECTS","validateChain","fetchPromise","fetchOptions","credentials","VAST_NONLINEAR_LOADING_FAILED","fetchAdXML","race","_resolve","VAST_LOAD_TIMEOUT","xmlText","xmlDom","parseFromString","xml2js","VAST_XML_PARSING_ERROR","parseVastXml","getFirstAd","VAST_NO_ADS_AFTER_WRAPPER","getAd","VAST_SCHEMA_VALIDATION_ERROR","VAST_UNEXPECTED_MEDIA_FILE","VAST_UNEXPECTED_AD_TYPE","validateResponse","UNKNOWN_ERROR","requestNextAd","vastResponse","nextAd","useAdBuffet","availableAds","adDefinition","hasAdBeenRequested","currentPod","nextPodSequence","getNextPod","availableAd","getNextAd","newVastChain","callbackHandler","waterfall","fetchVastChain","isCanceled","runEpoch","onAdStart","onRunFinish","newEpoch","lastVastResponse","vpaidEnabled","isVpaid","validateVastResponse","validateVastChain","createVideoAdContainer","adUnitPromise","timedOut","timeoutPromise","VAST_MEDIA_LOAD_TIMEOUT","waitAdUnit","newAdUnit","run","transformVastResponse","handleVastError","textArea","querySelector","testButton","eventHandler","requestAdRun","resumeContent","canceled","onAdStartHandler","navigator","userAgent","MSStream","runWaterfall","remove"],"sourceRoot":""}